---
Title: Автогенерация
Keywords: AutoGeneration
Link: CMP.AutoGenerate
---

# Класс AutoGenerate
---

Автогенерация позволяет формировать классы для работы с указанным типом объекта на основании
настроек, описанных в таблицах записей (Bas.Config.ProcType, МашРек.Настройки.Представление,
МашРек.Настройки.Реквизит). Файлы формируются в надпроекте, указанном в глобальной настройке
ExtProjectCMP. Список создаваемых файлов:
- IRecord-файл. В зависимости от значения поля RT-класс объекта формируется либо новый
IRecord-класс в соответствии с [иерархией наследования](HierarchicalProcType), либо расширение
(extends) существующего класса. Файл формируется в папке в соответствии с указанным в поле
RT-класс значением;
- IStruct-файл. Если среди [перcонализированных реквизитов](PersonalProps) типа объекта есть
табличные, то помимо IRecord-файла также создается IStruct файл, а в свойстве
PositionStructClass основного класса указывается ссылка на создаваемых IStruct-класс. Файл
формируется в той же папке, что и соответствующий ему IRecord-файл;
- Frm-файл. Для каждого типа объекта создается IEditor класс, наследник класса
CMP.Frm.BaseObjectClass. Этот класс прописывается в IRecord как EditorClass и используется
как бланк редактор когда в типе объекта отключены настройки. Файл формируется в папке Forms
и имеет наименование в соответствии с кодом типа объекта;
- файлы представлений. Для каждого представления (кроме представлений типа Редактирование
ссылочного реквизита) создается отдельный класс. В этом классе описывается форма представления
и логика его работы. Файлы формируются в папке Views в соответствии с иерархией представления.
Имя файла соответствует коду представления.

При повторном формировании файла(ов) все содержимое файлов очищается и генерируется заново,
поэтому ручное изменение автоматически сгенерированного файла не рекомендуется.

##IRecord/IStruct классы

Все перcонализированные реквизиты описываются в IRecord/IStruсt классах. Если поле с
таким именем уже описано в базовом и/или расширяемом классе, то оно повторно не описывается.
В случае расширения классов, все поля получают атрибут AutoGenerate равный ClassName
формируемого класса. Этот атрибут используется для повторного переформирования расширения
(иначе все поля получаются уже описаны).

Помимо блока описания полей в создаваемом файле формируются:
- метод инициализации полей (Init);
- методы обработки событий DoCreate, DoPost, DoVerify, DoAfterPost, DoDuplicate, DoDelete,
DoCancel, OnAfterDelete, BeforeShowCard, OpeningView, BeforeCloseView (для IStruct
InitNewPosition и DoDelete);
- блок автопересчетов OnCalc;
- блок пересчетов при изменении OnChange, OnManualChange и OnTouch;
- блок проверки лимитов OnVerify;
- блок сервисов.

Все пересчеты, кроме действий перед сохранением, вызываются после соответствующих пересчетов
из базовых классов. Для действий перед сохранением порядок обратный, сначала сформированный
код из параметрических настроек, потом вызов базового метода DoVerify.

Для сложных реквизитов (сервисы, нумератор, реквизит-отчет и т.п.) в блоке сервисов
формируется код исполнения реквизита. В зависимости от реквизита это может быть процедурой
или функцией, которые могут быть вызваны программно из пересчетов или из
классов форм. Код исполнения создает объект, наследник IProperty нужного класса, без
привязки к настроечной записи и программно устанавливает в нем параметры в соответствии с его
настройкой. При вызове этого реквизита вызывается соответствующий метод из класса, наследника
IProperty, который исполняет код по аналогии с параметрической настройкой. Для автоматической
генерации кода сложного реквизита нужно установить атрибут AutoGenerate=True для каждого
параметра такого реквизита, а также для каждого параметра структур подтаблиц всех уровней
вложенности этого реквизита.

##Frm-классы и классы представлений

В Frm-классе описываются все подзагружаемые представления, а также метод SetVisibility, в
котором описаны формулы видимости каждого представления. Также в методе Init добавляются
пересчеты от всех полей, от которых зависит видимость представлений. Для представления типа
Редактирование ссылочного реквизита в качестве формы представления создается бланк-редактор
по-умолчанию для нужного класса записи. В частности это в свою очередь может быть
сформированный Frm-класс.

Каждый cod-файл представления состоит из следующих блоков:
- блок описания переменных, состоящих из контролов, участвующих в логике текущего
представление. Формируется методом GenerateVars;
- блок инициализации переменных. Описание разлицных свойств переменных, которые невозможно
указать в crf-файле. В частности пересчеты, вызываемые при изменении полей текущего объекта.
Формируется методом GenerateInitProps;
- блок методов и обработчиков формы. Формируется методом GenerateAddCodes

Типы представлений:
- IDocument. Формируется класс, наследник CMP.Frm.BaseDocument. Состоит из crf-файла с
описанием шапки, таблиц и подвала. Для каждого вида настройки вызывается метод,
обрабатывающий каждую строку настройки, формирует лист для crf файла, а также
вспомогательные массивы для генерации блоков cod-файла;
- IObjectList. Формируется класс, наследник CMP.Tab.IObjectList. Состоит из crf-файла с
описанием столбцов картотеки и панели фильтрации, а также cod-файла, в котором указываются
параметры фильтрации и другие параметры картотеки;
- IViewsContainer. Формируется класс, наследник Com.Frm.IEditor. Состоит из crf-файла с
описанием взаиморасположения фреймов, из которых сотоит контейнер. В cod-файле описываются
методы загрузки встроенных представлений во фреймы;
- IPrintForm. Формируется класс, наследник CMP.Frm.BasePrintForm. Состоит из "пустого"
crf-файла, который тредуется для корректной работы класса, серверного cod-файла, также
требующегося для корректной работы, а также клиентского cod-файла, в котором указываются
параметры печатной формы: класс печатной формы, шаблон печатной формы и массив псевдонимов.
Клиентский cod-класс формируется в папке, аналогичной серверному классу, но в ветке Classes.
Помимо файлов класса, также формируется (при необходимости) tpl-файл шаблона в ветку
Attachment.PrintForms, который и используется в классе представления;
- IProjectForm. Формируется класс, наследник указанной в настройках проектной формы. Crf-файл
не формируется. В cod-файле формируется код добавления компонент в соответствии с настройками
представления;
- IReport. Формируется класс, наследник CMP.Frm.BaseReport. Crf-файл не формируется. В
cod-файле формируется код с описанием переменной с именем отчета, а также инициализация
связи параметров отчета и полей документа.

##Ограничения

При при формировании проекта на основании параметрических настроек и создания новой ИБ
на таком проекте есть ограничения
- Нет автогенерации классов для панелей-управления. В результате в новой сессии нет
точек входа. Меню и ролевые центры придется создавать вручную.
- Записи (ссылки на справочники и данные), участвующие в формулах, отчеты,
используемые в параметрической настройке, а также записи, используемые в условиях отбора
этих отчетов нужно перенести в новую базу вручную, используя tbc-файлы.