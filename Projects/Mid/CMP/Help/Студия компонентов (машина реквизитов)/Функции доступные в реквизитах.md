# Функции, доступные в реквизитах

Перечень функций, доступных в формулах реквизита: 

####Функция "MakeIs" в реквизитах

Данная функция предназначена для решения проблемы двух операторов IS, существующих в ТБ.Студии. 

Дело в том, что в языке фильтров, применяемом для отбора записей из таблиц информационной базы, оператор IS означает "входит в группу" по иерархии записей, а в языке ТБ.Скрипт IS - это оператор приведения типов. Выражения в формулах реквизитов записываются на языке ТБ.Скрипт, поэтому, если требуется, скажем, написать в каком-либо условии формулу типа "менеджер принадлежит группе "отдел продаж", нельзя написать просто 

        Менеджер IS Процесс('Отдел продаж') 

т.к. это вызовет ошибку, т.к. оператор IS будет интерпретирован как оператор приведения типов. Вместо этого надо формировать логическое выражение с помощью функции MakeIs:
        MakeIs('Менеджер', Процесс('Отдел продаж')). 

Описание функции:
        func MakeIs (
        аПараметр :String;
        аГруппа   :Record
        ) :String;

Функция формирует строку с выражением, интерпретация которого дает True, если значение параметра аПараметр, в котором содержится имя ссылочного поля, равно ссылке на запись, переданной в параметре аГруппа, или является ссылкой на запись, по иерархии входящей в группу аГруппа или одну из ее подгрупп. 

####Функция "Value/Значение/ТекущееЗначение" в реквизитах

Описание функции: 

        func Value synonym Значение, ТекущееЗначение :Variant; 

Функция возвращает значение реквизита, для которого идет пересчет. Данную функцию имеет смысл употреблять в пересчетах по событиям. 

####Функция "ВыбратьЗапись" в реквизитах
Описание функции:
      func ВыбратьЗапись(
      аПредварительноОчищать :Logical = False;
      аОднозначныйВыбор      :Logical = True;
      аФильтр                :Srting  = '';
      аУпорядочивание        :String  = '';
      аКлассЗаписи           :Class Record = nil;
      аПодзагружаемыеПоля    :String = ''
      ) :Record;

Функция возвращает запись, удовлетворяющую ограничениям реквизита, для которого производится вычисление.

Параметр аОднозначныйВыбор отвечает за то, нужно ли выбирать только в случае, если под ограничение попадает единственная запись (True) или нет (False). 

Параметр аПредварительноОчищать отвечает за то, что нужно вернуть, если под фильтр ничего не попадает или, в случае однозначного выбора, попадает более одной записи: True - вернуть nil, False - оставить предыдущее значение. 

С помощью параметра аФильтр передается фильтр, в соответствии с которым выбирается запись. Если параметр опущен, то для выбора записи используется фильтр, заданный в ограничениях реквизита, который заполняется с использованием данной функции. 

С помощью параметра аУпорядочивание можно задать приоритет выбора записи при неоднозначном выборе. 

Параметр аКлассЗаписи является необязательным и определяет класс записи, который необходимо выбрать. Если параметр не указан, то класс определяется как класс записи, с которым работает реквизит, для которого производится вычисления. 

Необязательный параметр аПодзагружаемыеПоля определяет поля записи, которые будут загружены с сервера на клиент в момент поиска записи. Данный параметр можно использовать для оптимизации работы функции подзагрузок. 

Функция имеет смысл только для реквизитов ссылочного типа. 


####Функция "Группы" в реквизитах

Данная функция устанавливает фильтр на поле класса записи определенных групп. Как правило, она используется в выражениях фильтров прав доступа. В момент вызова функции Группы (например, при наложении фильтра прав доступа при старте сессии) выполняется запрос записей, входящих в переданные нее в качестве параметров группы иерархии, и затем формируется фильтр типа ``"DocID in [...]"``, который выполняется сервером данных быстрее и эффективнее, чем фильтр с оператором IS или другим видом отбора по иерархии. 

Используя функцию Группы, имеет смысл накладывать фильтр на постоянные параметры Структуры бизнеса. К примеру, если при работе функции в определенном списке групп, на который наложен фильтр, был добавлен новый элемент, то этот элемент уже не войдет в фильтр. 

Описание функции: 
      func Группы(
      аТипЗаписи    :Class;
      аПараметр     :String;
      аСписокГрупп  :Record[]
      ) :String;
Через параметр аТипЗаписи передается класс записи списка групп, на который необходимо установить фильтр. 

Через строковый параметр аПараметр передается поле списка групп, по которому формируется фильтр. 

Параметр аСписокГрупп указывает массив групп класса записи, поля которых будут учитываться при формировании фильтра. 

####Функция "ЗначениеПоляПодтаблицы" в реквизитах

Данная функция позволяет получить значение определенного поля строки, в которой происходят пересчеты объекта, заданной подтаблицы. 

Описание функции:
      func ЗначениеПоляПодтаблицы(
      аИмяПодтаблицы :String;
      аИмяПоля       :String
      ) :Variant;

Обязательный параметр аИмяПодтаблицы указывает на подтаблицу объекта, из которой необходимо получить значение поля. 

Через параметр аИмяПоля передается поле подтаблицы, значение которого нужно определить. 

####Метод "ИндексПозиции" в реквизитах

Описание метода: 
       ИндексПозиции :Integer; 

Метод ИндексПозиции позволяет получить индекс позиции подтаблицы, в рамках которой идут пересчеты. 

####Метод "Интерфейс" в реквизитах

Описание метода: 

       Интерфейс :Базовые.интЗаписьСРеквизитом; 

Метод Интерфейс позволяет получить интерфейс объекта, в рамках которого идут пересчеты, а также обратиться к методам интерфейса. 

####Функция "КоличествоПозиций/PositionsCount" в реквизитах 

Функция вычисляет количество позиций (строк) в подтаблице объекта. 

Описание функции:

       func КоличествоПозиций synonym PositionsCount(аФильтр :String = '') :Integer;

Через необязательный строковый параметр аФильтр задается фильтр для подтаблицы. Если параметр не указан, то функция возвращает количество строк во всей подтаблице. 

####Функция "НастройкиСервера"

Функция возвращает ссылку на объект, описывающий параметры текущего сервера. 

Описание функции: 

       func НастройкиСервера :Настройки.ПараметрыСервера 

Передаваемых параметров в функции нет. Функция возвращает ссылку на объект, содержащий параметры текущего сервера. Возможные параметры сервера описаны в разделе Параметры сервера.


####Функция "НачалоУчета" в реквизитах

Описание функции:

       func НачалоУчета(аОбластьУчета :String) :Date

В строковом параметре аОбластьУчета в функцию передается имя области учета. 

Функция возвращает дату, ранее которой период по данной области учета закрыт. Если в качестве параметра передана пустая строка, то функция возвращает минимальную принятую в системе дату проводки (01.01.1900).

####Функция "Позиция" в реквизитах

Описание функции:

       func Позиция :Structure;

Функция возвращает ссылку на позицию (строку) подтаблицы объекта, в котором происходят пересчеты. 

####Функция "ПолеУникально" в реквизитах

Функция проверяет уникальность поля записи. 

Описание функции:
      func ПолеУникально synonym FieldUnique(
      аПоле :String;
      аДопПоле :Logical = False
      аФильтр :String = ''
      ) :Logical;

В качестве параметра аПоле передается имя поля, значение которого нужно проверить на уникальность. 

Необязательный логический параметр аДопПоле указывает на дополнительное поле. Если этот параметр имеет значение True, то будет проверяться уникальность дополнительного поля. Иначе - нет. 

С помощью необязательного параметра аФильтр можно ограничить множество записей, в которых нужно проверять уникальность этого поля. 

Результат функции - логическое значение. Функция возвращает True, если поле имеет уникальное значение, иначе False. 

####Функция "ПолучитьДопПолеПроцесса" в реквизитах

При помощи данной функции можно получить значение дополнительного поля из указанной записи любого класса, унаследованного от класса записи БазоваяСРеквизитом. 

Описание функции:
      func ПолучитьДопПолеПроцесса(
      const аПроцесс :Базовые.БазоваяСРеквизитом;
      аДопПоле :String;
      aIndex   :Integer = 0
      ) :Variant;

Параметр аПроцесс указывает на запись, из которой необходимо получить значение дополнительного поля. Запись может быть указана из любого класса записи, унаследованного от БазоваяСРеквизитом, в которой используются дополнительные поля. 

Через параметр аДопПоле указывается имя дополнительного поля, значение которого необходимо получить. 

Необязательный параметр aIndex указывает на строку подтаблицы, из которой необходимо получить значение дополнительного поля, если оно используется в подтаблице записи. 

####Функция "ПолучитьРеквизитПроцесса" в реквизитах

При помощи данной функции можно получить значение конкретного реквизита из указанной записи любого класса, унаследованного от класса записи БазоваяСРеквизитом. 

Описание функции:
      func ПолучитьРеквизитПроцесса(
      const аПроцесс :Базовые.БазоваяСРеквизитом;
      аКод     :String;
      aIndex   :Integer = 0
      ) :Variant;

Параметр аПроцесс указывает на запись, из которой необходимо получить значение реквизита. Запись может быть указана из любого класса записи, унаследованного от БазоваяСРеквизитом, в которой используются реквизиты. 

Через параметр аКод указывается код реквизита, значение которого необходимо получить. 

Необязательный параметр aIndex указывает на строку подтаблицы, из которой необходимо получить значение реквизита, если он является табличным

####Метод "ПроверяемоеЗначение" в реквизитах

Описание метода: 

     ПроверяемоеЗначение :Variant; 

Метод ПроверяемоеЗначение используется при проверке реквизитов-лимитов. Служит для получения нового, еще не установленного значения реквизита. 

####Функция "Процесс" в реквизитах

Описание функции: 
     func Процесс :Record; 
Функция возвращает ссылку на объект, для которого идут пересчеты. 

####Функция "ТекущееПредставление" в реквизитах

Описание функции:
     func ТекущееПредставление :Представления.интПредставление;
Данная функция возвращает интерфейс активного представления объекта. 

####Функция "ВидПериодаКарточкиСоздателя" в реквизитах

Функция определяет значение периода карточки объекта, в контексте которого был создан текущий объект. 

Описание функции:
     func ВидПериодаКарточкиСоздателя :ПериодыВремени
Функция возвращает период времени карточки-создателя, из которой был создан текущий объект. Период времени - это предопределенная в системе целочисленная константа. Возможные константы периода времени, возвращаемые данной функцией, перечислены ниже. 

**Константы периода времени**

Стандартные константы периода времени, предусмотренные в проекте ТБ.Управление. 
        0 = Интервал времени между определенными датами.
        1 = День.
        2 = Неделя.
        3 = Месяц.
        4 = Квартал.
        5 = Год.
        6 = Все время.
        7 = Последний месяц.
        8 = Полугодие.
        9 = период в 9 месяцев.
Таким образом, если результат вычисления функции - одно из перечисленных целых чисел, то значением периода объекта-создателя будет являться период времени, соответствующий целому числу.


####Функция "ДатаКарточкиСоздателя" в реквизитах

Функция определяет дату карточки объекта, в контексте которого был создан текущий объект. 

Описание функции:
     func ДатаКарточкиСоздателя(аПоказатьНачальнуюДатуПериода :Logical = True):Date

Логический параметр аПоказатьНачальнуюДатуПериода указывает, возвращать ли начальную дату из карточки объекта-создателя (значение True или по умолчанию) или конечную дату (значение False). 

Функция возвращает дату карточки объекта, из которой был создан текущий объект. Ссылку на сам объект-создатель можно получить с помощью функции "Создатель".

####Функция "КурсДокумента" в реквизитах

Функция предназначена для вычисления нестандартного курса валют в документе. 

Описание функции:
     func КурсДокумента(
     аДата            :Date;
     аПроцесс         :Данные.Процесс = nil;
     аИсходнаяВалюта  :Справочники.ЕдиницаИзмерения = nil;
     аЦелеваяВалюта   :Справочники.ЕдиницаИзмерения = nil
     ) :Numeric;

Возвращает количество единиц необходимой валюты за единицу исходной с учетом нестандартного курса на указанную дату в заданном типе объекта. 

Обязательный параметр аДата - дата, на которую необходимо вычислить курс. 

аПроцесс является необязательным параметром. Указывается объект, в котором необходимо пересчитать курс указанных валют. Если данный параметр не указан, то функция вычисляет в текущем объекте. 

Необязательный параметр аИсходнаяВалюта - валюта, относительно которой необходимо вычислить количество единиц необходимой (целевой) валюты. Если данный параметр не указан, то валюта берется из валюты объекта. 

Необязательный параметр аЦелеваяВалюта - валюта, в которую необходимо произвести вычисления с учетом нестандартного курса. Если параметр не задан, то за целевую валюту берется рубль. 

####Функция "Создатель" в реквизитах

Функция возвращает ссылку на объект, в контексте которого было создан данный объект.

Описание функции:
     func Создатель :Record;
Значение функции определено только в случае создания нового объекта, если объект открыт на редактирование, то функция возвращает ссылку на пустой объект. 

####Функция "УчСуммаКуда" в реквизитах

Функция получает учетную сумму со стороны "Куда" в строке документа на основании настроек заданного варианта стоимостного учета. 

Описание функции: 
     func УчСуммаКуда(парВариантУчета :Настройки.ВариантСтоимостногоУчета) :Numeric 
Функция имеет один параметр парВариантУчета - вариант стоимостного учета, для которого требуется найти учетную сумму со стороны "Куда". 

Результат функции - число. 


####Функция "УчСуммаОткуда" в реквизитах

Функция получает учетную сумму со стороны "Откуда" в строке документа на основании настроек заданного варианта стоимостного учета. 

Описание функции: 
     func УчСуммаОткуда(парВариантУчета :Настройки.ВариантСтоимостногоУчета) :Numeric 
Функция имеет один параметр парВариантУчета - вариант стоимостного учета, для которого требуется найти учетную сумму со стороны "Откуда". 

Результат функции - число. 

####Функция "УчЦенаКуда" в реквизитах

Функция отображает учетную цену со стороны "Куда" в строке документа на основании уже рассчитанных цен по заданному варианту стоимостного учета. 

Описание функции:
     func УчЦенаКуда(парВариантУчета :Настройки.ВариантСтоимостногоУчета) :Numeric 

Функция имеет один единственный параметр парВариантУчета - вариант стоимостного учета, для которого требуется найти учетную цену со стороны "Куда". 

Результат функции - число. 

####Функция "УчЦенаОткуда" в реквизитах

Функция отображает учетную цену со стороны "Откуда" в строке документа на основании уже рассчитанных цен по заданному варианту стоимостного учета. 

Описание функции:
     func УчЦенаОткуда(парВариантУчета :Настройки.ВариантСтоимостногоУчета) :Numeric 

Функция имеет один единственный параметр парВариантУчета - вариант стоимостного учета, для которого требуется найти учетную цену со стороны "Откуда". 

Результат функции - число. 

####Функция "Цена" в реквизитах

Описание функции:
    func Цена(
      аПроцесс           :Данные.Процесс = nil;
      аПоля              :String[] = nil;
      аЗначения          :Variant[] = nil;
    var аЕдИзм             :Справочники.ЕдиницаИзмерения[] = nil;
      аБратьБазовуюЕдИзм :Integer = 0;
      аДата              :Date = nil;
    const аИспользоватьСвободныеПрайсы :Logical = False
    ) :Numeric;
Функция выполняет поиск цены в действующих прайс-листах для процесса, чье значение указано в параметре аПроцесс или для текущего документа, если этот параметр опущен. 

С помощью параметров аПоля и аЗначения можно указать условие, по которому будут отбираться цены в прайс-листах. Оба эти параметра представляют собой массивы. 

В параметре аПоля указываются имена полей прайс-листов, на которые нужно наложить ограничение. Если это поле шапки, то перед именем поля нужно указать символ ``"^" (например, "^Замок")``, таким образом можно управлять из какого прайс-листа брать цену. К тому же существует возможность задавать цену в прайс-листах не за сам ресурс, а за группу ресурсов. Чтобы включить иерархию по какому - либо ресурсу (или по обоим), надо перед именем поля ресурса (``"РесурсОткуда", "РесурсКуда") поставить знак "#" (например, Цена(,['#РесурсОткуда', '#РесурсКуда'],[%1, %2])`` - иерархия по обоим ресурсам). Порядок следования полей ресурса тоже имеет важность, если первым указано поле #РесурсОткуда, то поиск будет проводиться до более точного подходящего РесурсаОткуда, а потом уточняется РесурсКуда. 

Во втором массиве параметра аЗначения (в том же порядке) указываются значения ограничений. Ограничения задаются по равенству, т.е. окончательное условие получается следующего вида: ``"(Поле1 = Значение1) and (Поле2 = Значение2) and ..."`` 

Параметр аЕдИзм указывает единицы измерения, в которых надо вернуть единицу измерения и/или валюту цены. Если параметр не задан, то в качестве единиц измерения будут неявно подставлены значения полей ЕдИзмОткуда и ЕдИзмКуда из позиции документа, для которой происходит вычисление функции Цена. Если опущено какое-либо одно значение этого массива, то вместо пропущенной единицы измерения будет возвращено значение единицы измерения из прайс-листа. 

Параметр аБратьБазовуюЕдИзм указывает, надо ли производить поиск в базовых единицах измерения. Если цена не будет найдена в тех единицах измерения, которые заданы с помощью параметра аЕдИзм, то поиск будет проводиться в базовых для них единицах измерения. Если параметр равен -1, то поиск цены в базовых единицах измерения будет проходить для первой единицы измерения, указанной в массиве аЕдИзм, если значение равно 1 - то для второй единицы измерения, указанной в массиве аЕдИзм. Если параметр аБратьБазовуюЕдИзм равен 0, то поиск не производится.

Параметр аДата указывает дату, на которую необходимо искать цену в прайс-листах. Если этот параметр не задан, дата берется равной начальной дате процесса, для которого происходит поиск цены. 

При помощи логического параметра аИспользоватьСвободныеПрайсы можно указать, использовать свободные прайс-листы (значение True) или не использовать (значение False по умолчанию). Если установлено значение True и алгоритм не нашел цену в обычных прайс-листах, то поиск цены будет производиться в свободных прайсах ("Свободный прайс" - прайс-лист, который не привязан ни к какому процессу). Не желательно включать данный параметр без кэш-памяти. 
