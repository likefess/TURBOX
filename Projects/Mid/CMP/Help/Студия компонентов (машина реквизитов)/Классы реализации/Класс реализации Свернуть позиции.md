# Класс реализации "Свернуть позиции"

Реквизит с классом реализации "Сервис сворачивания позиций" позволяет просуммировать/конкатенировать значения реквизитов в табличной части документа. При помощи перечисленных ниже параметров можно настроить алгоритм сервиса таким образом, что сворачивать значения реквизитов можно одновременно, группируя их по определенному реквизиту. 

* Флаг "Создавать новые учетные движения". Установка данного флага позволяет хранить результат свертки позиций в созданных движениях. Другими словами, если опция установлена, то просуммированные/конкатенированные значения будут записаны в отдельную таблицу с указанными учетными движениями, а не вместо существующих позиций. 
* Тип нового движения. При установке флага "Создавать новые учетные движения" добавляется опция, позволяющая указать тип создаваемого движения. Если тип движения не задан, то, по умолчанию, движение создается с тем же типом, что и у исходной позиции, при этом в поле серым цветом отображен текст "тот же, что и у исходной позиции". Если суммируются/конкатенируются несколько позиций с разным типом движений, а настройка "Тип нового движения" не указана, то тип движения создаваемой позиции будет таким же, что у первой сворачиваемой позиции.
* Условия обработки позиции. Предоставляется возможность задать дополнительное условие обработки позиций. К примеру, сворачивать позиции, только в случае если типом движения этих позиций является Обычное движение. Условие задается при помощи редактора формул реквизита и должно возвращать логическое значение. Если оно не задано, то обрабатываются все позиции без исключения. 
* Реквизиты, которые должны остаться уникальными. Если указать в данной настройке некий реквизит, то, при вызове сервиса, значения позиций табличной части документа будут просуммированы/конкатенированы в рамках одного и того же значения указанного уникального реквизита или в рамках одних и тех же значений всего набора уникальных реквизитов, если последних в настройку было введено несколько. Другими словами просуммированные/конкатенированные данные будут группироваться по заданному уникальному реквизиту. 
К примеру, если в качестве реквизита, который должен остаться уникальным, будет указан реквизит РесурсОткуда, то, вызвав сервис, позиции таблицы при суммировании/конкатенировании будут сгруппированы по одинаковым значениям реквизита РесурсОткуда. 
* Реквизиты, которые нужно суммировать/конкатенировать. Непосредственно в данной таблице указываются реквизиты, значения которых будут суммироваться/конкатенироваться. Если реквизитов было указано несколько, то их значения будут просуммированы/конкатенированы по каждому указанному реквизиту. Помимо реквизитов с типом значения число, которые при вызове сервиса суммируются, так же предоставляется возможность указывать реквизиты строкового типа, чьи значения будут сворачиваться по закону операции конкатенации (операция соединения нескольких строк символов в одну). Если был выбран реквизит строкового типа, то имеется возможность указать Разделитель между конкатенирующими значениями. 
* Флаг "Не обнулять все поля, имеющие разные значения в сворачиваемых позициях". Если данный флаг не установлен, то все реквизиты, которые имеют разные значения при свертке и не являются суммирующими/конкатенирующими, обнуляются. Причем, если сворачиваемая позиция в документе одна, то ни одно поле не будет очищено. Таким образом, может получиться ситуация, когда в результате свертки получились позиции, где некоторое значение реквизита пусто, а также позиции, где оно заполнено. Если данный флаг установлен, то появляется возможность вручную указать, какие реквизиты нужно очистить в результирующих строках. 
* Реквизиты, значения которых нужно обнулить. Данная настройка появляется, если флаг "Не обнулять все поля, имеющие разные значения в сворачиваемых позициях" не установлен. Таблица предназначена для указания тех реквизитов, чьи значения необходимо обнулить при отображении результата свертки позиций. 
