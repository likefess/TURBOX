#Редактор формул 


Выражение записывается в соответствии с синтаксисом встроенного языка ТБ.Скрипт. Общие правила и особенности составления формул, которые используются не только для реквизитов, но и в других полях. 

Формула реквизита может содержать названия других реквизитов, ссылки на записи, функции и операторы ТБ.Скрипт, а также несколько специальных функций. Часть из них относится к так называемому базовому вычислителю, функционал которого всегда доступен в полях настройки структуры бизнеса, в которые вводятся формулы пересчетов. К числу таких функций относятся, например, функции Право, Загл, ТекущийСубъект, ВызватьФункцию.
Остальные функции предоставляются так называемым вычислителем реквизита и доступны только в формулах реквизитa.


Формулы в реквизитах необходимо вводить в специальной форме, называемой "Редактор формул". Каждая такая форма открывается по нажатию кнопки Выбор ![](topic:Com.AddFiles.Btn_select.png) в поле ввода формулы реквизита. 

Данный способ был организован в целях сохранения ссылочной целостности. Она достигается тем, что в формуле фактически хранятся лишь порядковые номера использованных в выражении ссылок (в порядке их добавления в формулу), а сами ссылки на реквизиты и записи помещаются в том же порядке в связанную с формулой таблицу. 

Редактор формул представляет собой диалоговое окно с опциями, позволяющими задать необходимую формулу:
 
* Сама формула, а также используемые в ней реквизиты и записи, вводятся в строке "по формуле" редактора.  В строке отображается полное наименование записей и реквизитов, т.е. так, как будет выглядеть формула в поле ввода формулы.
* Кнопка "Реквизит" ![](topic:Com.AddFiles.Buttons.Btn_Settings_menager.png) позволяет указать реквизит, который будет являться компонентой формулы. Выбранный реквизит будет отображен в первой строке редактора под соответствующим порядковым номером. Если это первый элемент формулы, ссылающийся на реквизит, то в первой строке будет отображено %1; если второй, то - %2 и т.д. Ссылка на выбранный реквизит, в том же порядке будет храниться в специальной подтаблице "Записи". Если, выбранный реквизит используется в формуле дважды, то во второй раз используется просто порядковый номер, который ссылается на соответствующий реквизит. 
* Кнопка "Запись" ![](topic:Com.AddFiles.Buttons.Btn_base.png) позволяет выбрать необходимую запись из представленных классов записи. Выбранная запись, так же как и реквизит, будет отображена в строке редактора под соответствующим порядковым номером. Ссылка на выбранный реквизит будет храниться в подтаблице "Записи". 
* Кнопка "Проверка" ![](topic:Com.AddFiles.Buttons.Btn_zagr.png) позволяет проверить формулу на синтаксические ошибки.

В подтаблице "Записи" хранятся ссылки на используемые в формуле реквизиты и записи. Записи указаны в том же порядке, что и их порядковые номера в формуле - первая строка это первый номер компоненты формулы (%1), вторая строка - второй номер (%2) и т.д. Необходимо не нарушать порядок следования и взаимосвязи номеров и их ссылок. Таким образом, если из формулы был удален реквизит, а точнее его порядковый номер, то в подтаблице "Записи" необходимо удалить ссылку на этот реквизит, или вставить пустую строку, чтобы не нарушать порядок следования номеров и их ссылок. Обратное тоже верно. 