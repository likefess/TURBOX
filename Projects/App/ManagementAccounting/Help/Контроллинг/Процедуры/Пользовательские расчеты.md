#Пользовательские расчеты

----------

**Путь к документу:** Контроллинг - Процедуры - Пользовательские расчеты

**Назначение формы:** Форма предназначена для составления и выполнения пользовательских расчетов. Через работу с расчетами закладывается логика обработки данных.
Внутренняя аналитика необходима для обработки поступающей информации.

**Порядок работы с формой:**

![](topic:.AddFiles.Screenshot_20139.jpg)

1. для формирования расчета необходимо заполнить поля следующим способом: 

    - Вид расчета - выбрать вид расчета из выпадающего списка: Надбавка / Перенос данных / Раскладка / Распределение;

    Далее состав полей, внешний вид и порядок заполнения формы зависит от указанного значения в поле "Вид расчета".
    В Управленческом учете поддерживаются следующие виды расчетов:
    * ***Надбавка*** – увеличение суммы записей на объекте-получателе на заданную долю или сумму с дублированием статьи и всех аналитических признаков;
    * ***Перенос данных*** – перенос данных с объекта-отправителя на объект-получатель в полной сумме записей (без пропорционального разделения) со сменой всех аналитик и сохранением статьи;
    * ***Раскладка*** – перенос данных с объектов-отправителей на объекты получатели пропорционально заданным критериям с сохранением статьи и заменой статьи затрат на статью с типом «раскладка»;
    * ***Распределение данных*** – перенос данных с объектов-отправителей на объекты получатели пропорционально заданным критериям с сохранением статьи затрат и сменой аналитических признаков.

    1.1 **Надбавка**

    ![](topic:.AddFiles.Screenshot_20140.jpg)

    в блоке Параметры расчета необходимо заполнить поля:

    - Период - в поле "За" необходимо указать период, за который требуется провести анализ. Даты начала и конца периода устанавливаются с помощью календаря вручную (кнопка Выбор ![](topic:Com.AddFiles.Buttons.Btn_select.png)),
    диалога “Период” или автоматически, что зависит от значения выбранного из выпадающего списка в поле За:
        * период – с помощью диалога “Период”; 
        * день – с помощью календаря; 
        * неделя – с помощью диалога “Период”; 
        * месяц – с помощью диалога “Период”; 
        * посл. месяц – автоматически; 
        * квартал – с помощью диалога “Период”; 
        * полугодие – с помощью диалога “Период”; 
        * год – с помощью диалога “Период”; 
        * все время – с помощью диалога “Период”. 

        *Замечание! Особенность работы стандартного периода: для корректной работы периода необходимо указать сначала год, а  затем месяц.*

    - Единица учета - единица учета, в которой производится расчет. Выбрать из картотеки *Единица Учета* (кнопка Выбор ![](topic:Com.AddFiles.Buttons.Btn_select.png)), для которой производится расчет;
    - Коэффициент - указать коэффициент надбавки. Заполняется вручную. Поле обязательное для заполнения;

    Заполнить поля для источника надбавки и получателя надбавки:
    - Тип аналитики - выбрать аналитические признаки из выпадающего списка: ЦФО / Подразделение / Заказ / Проект / Договор / Продукт, по которым будут отбираться и формироваться записи из БД для обработки/выполнения в расчете;
    - Значение аналитики - выбрать значение из картотеки соответствующей типу аналитики (кнопка Выбор ![](topic:Com.AddFiles.Buttons.Btn_select.png));
    - Схема замещения статей - выбрать схему из картотеки *Список схем замещения статей* (кнопка Выбор ![](topic:Com.AddFiles.Buttons.Btn_select.png)).

    1.2 **Перенос данных**

    ![](topic:.AddFiles.Screenshot_20141.jpg)

    в блоке Параметры расчета необходимо заполнить поля:

    - Период - указать период, за который требуется провести расчет;
    - Единица учета - единица учета, в которой производится расчет. Выбрать из картотеки *Единица Учета* (кнопка Выбор ![](topic:Com.AddFiles.Buttons.Btn_select.png)), для которой производится расчет;

    Заполнить поля для данных переноса и перенесенных данных:
    - Тип аналитики - выбрать тип аналитики, по которой будут отбираться/формироваться записи из БД для расчета, из выпадающего списка: ЦФО / Подразделение / Заказ / Проект / Договор / Продукт, по которым будут отбираться и формироваться записи из БД для обработки/выполнения в расчете;
    - Значение аналитики - выбрать значение из картотеки соответствующей типу аналитики (кнопка Выбор ![](topic:Com.AddFiles.Buttons.Btn_select.png));
    - Статья затрат - выбрать статью затрат из картотеки *Справочник типовых значений доходов/расходов* (кнопка Выбор ![](topic:Com.AddFiles.Buttons.Btn_select.png)). Поле доступно после выбора единицы учета.

    1.3 **Раскладка**

    ![](topic:.AddFiles.Screenshot_20142.jpg)

    в блоке Параметры расчета необходимо заполнить поля:

    - Период - указать период, за который требуется провести анализ;
    - Способ пропорции - выбрать способ пропорции расчета. Заполняется автоматически;
    - Статический показатель - указать статистический показатель, при помощи которого будет производиться расчет. Выбор из справочника *Статистические индикаторы* (кнопка Выбор ![](topic:Com.AddFiles.Buttons.Btn_select.png));
    - Единица учета - единица учета, в которой производится расчет. Выбрать из картотеки *Единица Учета* (кнопка Выбор ![](topic:Com.AddFiles.Buttons.Btn_select.png));
    - Схема замещения статей - схема замещения статей, которая участвует в расчете. Выбрать схему из справочника *Список схем замещения статей* (кнопка Выбор ![](topic:Com.AddFiles.Buttons.Btn_select.png));

    Заполнить поля для данных до раскладки и разложенных данных:
    - ЦФО - указать ЦФО из картотеки *Центры финансовой ответственности* (кнопка Выбор ![](topic:Com.AddFiles.Buttons.Btn_select.png)). Аналитический признак, по которому будут отбираться записи из БД для обработки в расчете / формироваться новая записи из БД в результате выполнения расчета;
    - Подразделение - указать подразделение из картотеки *Подразделения* (кнопка Выбор ![](topic:Com.AddFiles.Buttons.Btn_select.png)). Аналитический признак, по которому будут отбираться записи из БД для обработки в расчете / формироваться новая записи из БД в результате выполнения расчета;
    - Заказ - выбрать заказ из картотеки *Заказы* (кнопка Выбор ![](topic:Com.AddFiles.Buttons.Btn_select.png)). Аналитический признак, по которому будут отбираться записи из БД для обработки в расчете / формироваться новая записи из БД в результате выполнения расчета;
    - Проект - выбрать проект из картотеки *Проекты* (кнопка Выбор ![](topic:Com.AddFiles.Buttons.Btn_select.png)). Аналитический признак, по которому будут отбираться записи из БД для обработки в расчете/формироваться новая записи из БД в результате выполнения расчета;
    - Договор - выбрать договор из картотеки *Договоры* (кнопка Выбор ![](topic:Com.AddFiles.Buttons.Btn_select.png)). Аналитический признак, по которому будут отбираться записи из БД для обработки в расчете/формироваться новая записи из БД в результате выполнения расчета;
    - Продукт - выбрать продукт из картотеки *Продукты* (кнопка Выбор ![](topic:Com.AddFiles.Buttons.Btn_select.png)). Аналитический признак, по которому будут отбираться записи из БД для обработки в расчете/формироваться новая записи из БД в результате выполнения расчета.

    1.4 **Распределение**

    ![](topic:.AddFiles.Screenshot_20143.jpg)

    в блоке Параметры расчета необходимо заполнить поля:

    - Период - указать период, за который требуется провести анализ;
    - Способ пропорции - выбрать способ пропорции расчета. Заполняется автоматически;
    - Статический показатель - указать статистический показатель,при помощи которого будет производиться расчет. Выбор из справочника *Статистические индикаторы* (кнопка Выбор ![](topic:Com.AddFiles.Buttons.Btn_select.png));
    - Единица учета - единица учета, в которой производится расчет. Выбрать из картотеки *Единица Учета* (кнопка Выбор ![](topic:Com.AddFiles.Buttons.Btn_select.png));

    Заполнить поля для данных до раскладки и разложенных данных:
    - ЦФО - указать ЦФО из картотеки *Центры финансовой ответственности* (кнопка Выбор ![](topic:Com.AddFiles.Buttons.Btn_select.png)). Аналитический признак, по которому будут отбираться записи из БД для обработки в расчете / формироваться новая записи из БД в результате выполнения расчета;
    - Подразделение - указать подразделение из картотеки *Подразделения* (кнопка Выбор ![](topic:Com.AddFiles.Buttons.Btn_select.png)). Аналитический признак, по которому будут отбираться записи из БД для обработки в расчете / формироваться новая записи из БД в результате выполнения расчета;
    - Заказ - выбрать заказ из картотеки *Заказы* (кнопка Выбор ![](topic:Com.AddFiles.Buttons.Btn_select.png)). Аналитический признак, по которому будут отбираться записи из БД для обработки в расчете / формироваться новая записи из БД в результате выполнения расчета;
    - Проект - выбрать проект из картотеки *Проекты* (кнопка Выбор ![](topic:Com.AddFiles.Buttons.Btn_select.png)). Аналитический признак, по которому будут отбираться записи из БД для обработки в расчете/формироваться новая записи из БД в результате выполнения расчета;
    - Договор - выбрать договор из картотеки *Договоры* (кнопка Выбор ![](topic:Com.AddFiles.Buttons.Btn_select.png)). Аналитический признак, по которому будут отбираться записи из БД для обработки в расчете/формироваться новая записи из БД в результате выполнения расчета;
    - Продукт - выбрать продукт из картотеки *Продукты* (кнопка Выбор ![](topic:Com.AddFiles.Buttons.Btn_select.png)). Аналитический признак, по которому будут отбираться записи из БД для обработки в расчете/формироваться новая записи из БД в результате выполнения расчета.
    - Статья затрат - выбрать статью затрат из картотеки *Справочник типовых значений доходов/расходов* (кнопка Выбор ![](topic:Com.AddFiles.Buttons.Btn_select.png)). Поле доступно после выбора единицы учета.

2. выбрать способ выборки данных

    Пользовательский  расчет создается на основе выбранных данных.

    Способы выборки:
    * **Выбор из отчета** -  данные берутся из отчета, т.е. с помощью редактора отчетов можно использовать заложенную в выбранном отчете логику;

    * **Выбор из картотеки или базы данных** - при выборе данных для пользовательского расчета из БД или картотеки можно обработать как справочную информацию так и записи бизнес операций.


    ####Выбор данных для построения расчета из отчета: 

    ![](topic:.AddFiles.Screenshot_20144.jpg)

    Для выбора данных из отчета необходимо нажать кнопку ***Получить из отчета*** ![](topic:Com.AddFiles.Buttons.Btn_Reportts.png) и настроить параметры выбора в открывшейся форме **Выбор данных из отчета**:
    * Отчет - из картотеки *Настройки отчетов* (кнопка Выбор ![](topic:Com.AddFiles.Buttons.Btn_select.png)) укажите отчет, из которого будут выбраны данные;
    * флаг *Применить фильтр* - при установленном флаге к отчету применяется дополнительный фильтр установленный в поле *Фильтр*. Иначе - используются только фильтры установленные в отчете;
    * флаг *Применить период* - при установленном флаге к отчету применяется период установленный в поле *За*. Иначе - используется период, в разрезе которого формируется отчет;
    * флаг *Тип показателя* - при установленном флаге к заголовку таблицы добавляется тип показателя;
    * Фильтр - при необходимости вручную укажите правило фильтрации отчета;
    * Период - в поле "За" необходимо указать период, за который требуется провести анализ. Даты начала и конца периода проставляются соответственно с помощью календаря (кнопка Выбор ![](topic:Com.AddFiles.Buttons.Btn_select.png)), вручную, диалога “Период” или автоматически, что зависит от значения выбранного из выпадающего списка в поле За:
        * период – с помощью диалога “Период”; 
        * день – с помощью календаря; 
        * неделя – с помощью диалога “Период”; 
        * месяц – с помощью диалога “Период”; 
        * посл. месяц – автоматически; 
        * квартал – с помощью диалога “Период”; 
        * полугодие – с помощью диалога “Период”; 
        * год – с помощью диалога “Период”; 
        * все время – с помощью диалога “Период”. 

    *Замечание! Особенность работы стандартного периода: для корректной работы периода необходимо указать сначала год, а затем месяц.*

    Далее заполните таблицу *Выбор данных*:

    * Тип - в поле тип укажите разрез, контент или показатель отчета. Выбор из выпадающего списка;
    * Значение установите значение для выбранного типа. Выбор из выпадающего списка, список заполняется автоматически в зависимости от установленного значения в поле *Тип*;
    * Вывести - значение для расчета, выводимое на экран. Устанавливается в зависимости от выбранного Типа. Заполняется из выпадающего списка.
    Строки в таблицу добавляются/удаляются с помощью опции *Добавить кадр/Удалить кадр* в контекстном меню, вызываемом по щелчку правой кнопки мыши, или с помощью клавиш Ins/Del.

    Для применения выбранных данных из отчета нажмите на кнопку **ОК** ![](topic:Com.AddFiles.Buttons.Btn_OK_.png) , иначе  -  **Отмена**![](topic:Com.AddFiles.Buttons.BtnCloseCancel.png).


    ####Выбор данных для построения расчета из картотеки: 

    ![](topic:.AddFiles.Screenshot_20145.jpg)

    Для выбора данных из картотеки необходимо нажать кнопку ***Получить из картотеки*** ![](topic:Com.AddFiles.Buttons.Btn_Card.png) и настроить параметры выбора в открывшейся форме **Выбор данных из картотеки**:
    - Тип записи - из выпадающего списка укажите картотеку для выбора данных для расчета;
    - На закладке *Картотека* отобразятся данные выбранной картотеки. Для записей картотеки можно применить фильтр ![](topic:Com.AddFiles.Buttons.Btn_Filter.png);
    - На закладке *Дополнительные поля* необходимо установить название поля с помощью диалога *Выбор поля* открывающегося по кнопке Выбор ![](topic:Com.AddFiles.Buttons.Btn_select.png).
    Строки в таблицу добавляются/удаляются с помощью опции *Добавить кадр/Удалить кадр* в контекстном меню, вызываемом по щелчку правой кнопки мыши, или с помощью клавиш *Ins/Del*.

    ![](topic:.AddFiles.Screenshot_20146.jpg)

    - Для переноса всех записей картотеки в расчет нажмите кнопку *Перенести все* ![](topic:Com.AddFiles.Buttons.Btn_moveall.png).
    - Для переноса одной или нескольких записей картотеки, выделите записи и воспользуйтесь кнопкой *Выбрать* ![](topic:Com.AddFiles.Buttons.Btn_Select_Fingr.png) или ОК ![](topic:Com.AddFiles.Buttons.Btn_OK_.png).

3. далее в форме "Пользовательские расчеты" заполняются входные для расчета и выходные данные расчета. Таблицы значений на кладке *Входные данные* заполняются автоматически в зависимости от выбранных ранее настроек отбора данных расчетов. 

При установленном флаге *Выводить на экран* входные и выходные данные расчета отображаются на одноименных закладках документа. По-умолчанию флаг не установлен.

*Замечание: при оперировании большими объемами информации рекомендуется не выводить на экран данные расчета в целях обеспечения быстродействия системы.*

- закладка ***Входные данные*** отображается при установленном флаге *Выводить на экран*. Показывает входные данные для расчета. Заполняется автоматически. 
- закладка ***Выходные данные*** отображается при установленном флаге *Выводить на экран*. Показывает выходные данные расчета. Заполняется автоматически после выполнения операции *Предварительный расчет* или *Расчет*. 


**Назначение кнопок формы:**

* **Предварительный расчет** запускается по кнопке ![](topic:Com.AddFiles.Buttons.Btn_Calculation.png) и выполняет расчет без записи в БД. После выполнения операции на экран выводится сообщение об успешном завершении расчета;
* **Расчет** запускается по кнопке ![](topic:Com.AddFiles.Buttons.Btn_viewing.png) и выполняет расчет и запись в БД. После выполнения операции на экран выводится сообщение об успешном завершении расчета;
* **Управление именованными настройками**  ![](topic:Com.AddFiles.Buttons.Btn_Settings_menager.png):
    * **Сохранить настройки** -  открывает диалоговое окно *Ввод*. В поле *Сохранить как* заполнить вручную произвольным названием настройки, подтвердить кнопкой **ОК** иначе - **Отмена**;
    * **Диспетчер настроек** - открывает одноименный справочник с перечнем сохраненных настроек, применить выбранную настройку двойным щелчком левой кнопки мыши;
    * **Без настроек** - вернуться к первоначальным настройкам;
    * **Имя настройки** - применить соответствующую сохраненную настройку;
* **Отмена** ![](topic:Integration.AddFiles.Buttons.BtnCloseCancel.png) - выход без сохранения;
* **Помощь** - также кнопка F1 для получения помощи.

