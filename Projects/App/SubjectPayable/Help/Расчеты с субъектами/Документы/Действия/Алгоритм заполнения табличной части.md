#Алгоритм заполнения табличной части сервиса "Зачет авансовых платежей(пакетный)"
_____________________________

1. Проводится отбор документов «Оплата задолженностей» с установленным флагом «Аванс», по которым имеется остаток не зачтенного аванса по состоянию на дату
формирования данных. Отбор производится по счетам: ПоставщикиАванс, ПокупателиАванс, НалогиАванс, ПерсоналЗПАванс, ПерсоналАОАванс, ПрочиеДебиторыАванс,
ПрочиеКредиторыАванс. Фильтр по параметру Наше предприятие;

    **Примечание:!** в табличную часть документа не попадают документы «Оплата задолженности» (Аванс), в которых валюта оплаты отличается от валюты задолженности.

2. Осуществляется отбор документов «Начисление задолженности», по которым возможно произвести зачет авансового платежа. Формируется перечень задолженностей Нашего предприятия,
по которым имеется остаток не закрытой задолженности по состоянию на дату формирования данных. Остаток незакрытой задолженности рассчитывается без учета
не зачтенных авансовых платежей, т.е. не учитываются данные по счетам Аванс. Отбор производится по счетам; Поставщики, Покупатели, Налоги, ПерсоналЗП,
ПерсоналАО, ПрочиеДебиторы, ПрочиеКредиторы. Фильтр по параметру Наше предприятие;

3. Производится сопоставление документов «Оплата задолженности» с флагом Аванс и «Начисление задолженности» для формирования «Зачета аванса», по параметрам:
Контрагент, Тип начисления, Договор, Налог, Валюта задолженности, Сумма. Параметры Контрагент, Тип начисления, Договор (при наличии), Налог (при наличии),
Валюта задолженности – обязательно должны совпадать. Параметр "Сумма остатка задолженности" – должен быть не менее "Сумма не зачтенного аванса".
    - **При наличии только одного документа «Начисление задолженности», совпадающего по параметрам**, производится запись документа «Начисление задолженности»
    в таблицу, в строку с соответствующим документом «Оплата задолженности»;
    - **При наличии нескольких документов «Начисление задолженности», подходящих по параметрам документу «Оплата задолженности»** - производится проверка
    точного соответствия Суммы: если Сумма остатка задолженности = Сумме не зачтенного аванса (и такое совпадение только одно) – то производится запись документа
    «Начисление задолженности» в таблицу, в строку с соответствующим документом «Оплата задолженности»;
    - **В остальных случаях:** существует несколько документов «Начисление задолженности», сопоставимых с документом «Оплата задолженности», отсутствует возможность
    фильтрации по Сумме – блок «Док-т «Начисление задолженности»» - не заполняется по строке соответствующего документа «Оплата задолженности», пользователь должен
    вручную выбрать документ «Начисление задолженности», по которому должен быть произведен «Зачет аванса». Выбор – из всех проведенных в программе документов
    «Начисление задолженности» по Нашему предприятию и Контрагенту;

4. Определяется сумма аванса, которая подлежит зачету. К зачету аванса предлагается сумма, которая может быть списана и с остатка суммы не зачтенного аванса, и с остатка суммы незакрытой
задолженности (например, остаток аванса 1500 руб., остаток задолженности – 5000,00 руб. - можно зачесть только сумму 1500 руб.). В блоке «Зачет аванса» заполняются поля
«Сумма в вал. док-та» и «Сумма в опер. валюте» соответствующими суммами. Курс валюты для зачета аванса = курсу валюты согласно документа «Оплата задолженности»,
допускается ручное редактирование пользователем. Дата зачета аванса – по умолчанию равна текущей дате;