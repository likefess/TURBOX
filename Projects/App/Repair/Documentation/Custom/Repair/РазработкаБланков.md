##*.COD

Логика бланка описывается событийно-ориентированным программированием, где источником событий являются графические элементы бланка.
Список доступных событий для конкретного элемента можно проверить, инициализировать или назначить в свойствах элемента на вкладке «События».
Клик по выпадающему списку напротив имени события откроет список подходящих обработчиков, где серым цветом выделены унаследованные обработчики, а чёрным – описанные в данном классе.
Двойной клик по пустой ячейке создаст новый стандартный обработчик с подходящими параметрами, а по заполненной – откроет его в редакторе.

    func CellOnClick(Cell :TemplateCell; Action :Template.ClickTypes) :Logical;
        -- Обработка события нажатия в зависимости от типа
        -- Параметры:
        -- Cell: клетка шаблона
        -- Action: тип нажатия (SingleClick, DoubleClick, EnterPressed, ButtonPressed)
      Result = True; -- Разрешаем стандартную обработку
    end;

![](topic:Custom.AddFiles.СвойстваКлеток-События.png)

При удалении или переименовании обработчика необходимо очистить или переназначить связи во всех событиях, где использовался данный обработчик.
Для получений доступа к свойствам элемента из кода, необходимо в шаблоне бланка присвоить элементу уникальное имя, а в свойствах класса – объявить переменную с соответствующим именем и типом. 

##*.TPL

Шаблон бланка, разрабатываемый в визуальном конструкторе, может состоять из визуальных объектов ТУРБО и «секций».
Визуальные объекты
К визуальным объектам относятся:

- Кнопка
- Надпись
- Флаг
- Переключатель
- Редактор
- Список
- Рисунок
- Рамка
- РядЗакладок
- Проигрыватель
- OLEКонтейнер
- Таблица
- КартотекаШаблона
- ДеревоКартотеки
- ПодтаблицаШаблона
- OCXКонтрол
Для добавления визуального объекта в шаблон необходимо открыть пункт меню «Вставить объект», выбрать необходимый элемент и кликнуть в том месте, куда необходимо поместить данный элемент.

![](topic:Custom.AddFiles.КонтекстноеМеню-Вставить-Кнопка.png)

Каждый тип визуальных объектов имеет уникальный для него набор свойств и событий.
Визуальные объекты могут быть расположены как на фреймах, так и поверх секций.
Данные элементы идентифицируются через «Имя», которое должно быть уникальным в пределах шаблона.

![](topic:Custom.AddFiles.СвойстваКнопки-Общие.png)

###Секции

Секции представляют собой динамические таблицы и могут быть добавлены в шаблон по кнопке «Вставка секций…». Секции располагаются вертикально в пределах фрейма. Не более одной секции в одной строке.

![](topic:Custom.AddFiles.ВставкаСекций.png)

Секции состоят из клеток, число которых равно произведению количества строк на количество столбцов.
Каждой секции, а также её строке и столбцу, можно присвоить уникальное имя для обращения в коде.
Для изменения размеров отдельных клеток, секция может быть разделена на две части при помощи кнопки «Разрезать секцию». При этом будет отделена часть секции, расположенная ниже крайней нижней выделенной клетки. Обе секции станут независимыми элементами и будут иметь одинаковые свойства, за исключением имени и количества строк.
Для объединения двух секций используется кнопка «Склеить секции». При этом выделенная секция будет объединена со следующей, итоговое количество столбцов будет определено размером наибольшей секции, а ширина колонок – верхней секцией. Все заполненные значения будут сохранены.
Секции, клетки, строки и столбцы имеют отдельные свойства, позволяющие задать их формат и поведение при отображении или печати.
 
###Свойства секции

![] (topic:Custom.AddFiles.СвойстваСекции-Общие.png)

- Имя: позволяет задать уникальный идентификатор объекта.
- Строк/Столбцов: устанавливает размеры секции. Значение может быть изменено в любое время.
- Тип секции: используется при переносе заголовка/итога таблицы на следующий лист на печати.
- Обводка: задаёт цвет линии обводки для всей секции.
- Отображать на экране: управляет отображением объекта на форме при просмотре/редактировании бланка.
- Выводить на печать: управляет отображением объекта на печатной форме.

![](topic:Custom.AddFiles.СвойстваСекции-Повторение.png)

- Повторяющаяся секция: позволяет создать расширяемую секцию для отображения подтаблиц.
- Подтаблица: связывает повторяющуюся секцию с подтаблицей, описанной в MTL данного бланка.
- Фильтр: строковый фильтр для связанной подтаблицы.
- Ручное управление: позволяет разрешить пользователю добавлять, удалять или перемещать строки внутри повторяющейся секции.

###Свойства строки

![](topic:Custom.AddFiles.СвойстваСтроки-Общие.png)

- Имя: позволяет задать уникальный идентификатор объекта.
- Автоматическое определение высоты: изменение высоты строки в зависимости от размера шрифта и количества строк текста.
- Отображать на экране: управляет отображением объекта на форме при просмотре/редактировании бланка.
- Выводить на печать: управляет отображением объекта на печатной форме.
- Печатать с новой страницы: принудительный переход на новую страницу при печати.
- Не последняя на странице: по возможности предотвращает разрыв страниц между данной строкой и следующей.
- Не первая на странице: по возможности предотвращает разрыв страниц между данной строкой и предыдущей.

![](topic:Custom.AddFiles.СвойстваСтроки-Дополнительные.png)

- Ручное управление: позволяет разрешить пользователю скрывать строку или менять её размер.

Свойства «Не последняя на странице» и «Не первая на странице» применяются в случаях, когда необходимо гарантировать расположение группы строк в пределах одной страницы.

Доступ к свойствам строки может быть получен через контекстное меню, по клику на вертикальной линейке, напротив нужной строки.

![](topic:Custom.AddFiles.КонтекстноеМеню-СвойстваСтрок.png)

###Свойства столбца

![](topic:Custom.AddFiles.СвойстваСтолбца-Общие.png)
![](topic:Custom.AddFiles.СвойстваСтолбца-Дополнительные.png)

- Имя: позволяет задать уникальный идентификатор объекта.
- Отображать на экране: управляет отображением объекта на форме при просмотре/редактировании бланка.
- Выводить на печать: управляет отображением объекта на печатной форме.
- Ручное управление: позволяет разрешить пользователю скрывать столбец или менять его размер.

Доступ к свойствам столбца может быть получен через контекстное меню, по клику на горизонтальной линейке, напротив нужного столбца.

###Свойства клетки

![](topic:Custom.AddFiles.СвойстваКлеток-Общие.png)

- Стиль: позволяет выбрать заранее созданный набор свойств для данной клетки.
- Сворачивать строки: автоматический перенос слов и расширение клетки при её заполнении.
- Многострочность: включает возможность переноса строки.
- Использовать макросы: позволяет использовать макросы при обработке данных клетки (&)
- Можно выделять: позволяет пользователю выделять текст клетки, если она заблокирована.
- Переход табуляцией: включает выделение клетки нажатием клавиши «TAB».

![](topic:Custom.AddFiles.СвойстваКлеток-Формат-СтатическийТекст.png)

- Тип клетки: определяет поведение клетки. Статический текст – отображение содержимого клетки. Поле ввода/вывода – отображение или редактирование значения связанной переменной. Вычислимое поле – отображает значение по заданной формуле.
- Формат клетки: формат отображения значения.

###Структура документа

Пункт контекстного меню «Структура документа» состоит из трёх разделов: фреймов, стилей и команд.
Раздел «Фреймы» отображает иерархию фреймов данного шаблона. В данном разделе можно добавлять, удалять и перемещать фреймы.
Фреймы могут быть расположены как горизонтально, так и вертикально. При добавлении субфреймов необходимо учитывать то, что только последний фрейм в иерархии может содержать секции и объекты.
Фреймы могут быть скрыты при печати или просмотре бланка, что позволяет создавать панели меню и группировать элементы.
Раздел «Стили» позволяет применить один стиль для всех клеток, расположенных на данном фрейме.
Раздел «Команды» даёт возможность вызывать команды из функционала ТУРБО через кнопки или обработчики событий бланка. Также в данном разделе можно добавить новую команду и задать её поведение.

###Свойства шаблона

![](topic:Custom.AddFiles.СвойстваШаблона-Общие.png)

- Использовать стили в шаблоне: включает или выключает стили для всех элементов бланка.
- Использовать локализацию строк: перевод на другие языки (?)

![](topic:Custom.AddFiles.СвойстваШаблона-Окно.png)

- Стиль: задаёт стиль окна, в котором будет открываться данный бланк.
- Открывать несколько окон одновременно: разрешает открыть несколько копий данного бланка.
- Восстанавливать бланк на рабочем столе: если бланк был открыт на момент выхода из сессии, то при следующем входе он будет восстановлен. (Опция включена по умолчанию. Рекомендуется отключить, если бланк открывается не напрямую из меню.)
- Автоматический размер: растягивает границы бланка при изменении размеров элементов.

![](topic:Custom.AddFiles.СвойстваШаблона-Прочее.png)

- Настройки печати: путь к конфигурационному файлу настроек печати. Необходимо заполнить для корректного отображения данных на печати.
- Контекст помощи: путь к файлу, открываемому по команде «Помощь…»

###Настройка печати

![](topic:Custom.AddFiles.ДеревоПроекта-НастройкиПечати.png)

Конфигурационные файлы с настройками печати располагаются в каталоге проекта, в директории с типом «Приложения» и имеют расширение *.cfg.

![](topic:Custom.AddFiles.НастройкаПечати-Страница.png)
![](topic:Custom.AddFiles.НастройкаПечати-Параметры.png)

- Бумага: выбор стандарта бумаги.
- Ориентация: выбор ориентации листов на печати.
- Масштаб печати: позволяет масштабировать пропорционально в процентах или в листах по горизонтали и вертикали.

![](topic:Custom.AddFiles.НастройкаПечати-Поля.png)

- Поля: позволяет задать отступ от края листа. Линейки в дизайн режиме бланка не учитывают отступы настроек печати. При разметке их следует учитывать самостоятельно.

![](topic:Custom.AddFiles.НастройкаПечати-Колонтитулы.png)

- Колонтитулы: раздел колонтитулов позволяет задать логику отображения каждого из шести доступных колонтитулов. В колонтитул можно вывести значения переменных бланка, а также использовать макросы.

###Повторяющиеся секции

Повторяющиеся секции применяются, когда необходимо отобразить в бланке таблицу или массив значений. Стандартная повторяющаяся секция состоит из пяти секций с различающимися свойствами:

![](topic:Custom.AddFiles.Таблица.png)

1. Шапка таблицы: является обычной секцией. Содержит заголовки колонок таблицы и задаёт им размеры. Секция отображается в редакторе и на печати.
2. Заголовок: в свойствах секции, поле «Тип секции» устанавливается значение «Заголовок», а в свойствах строки – «Не последняя на странице». Дублирует значения шапки таблицы или содержит номера соответствующих колонок. Отображается только при печати. Обычно не выводится на первой странице таблицы.
3. Итог: в свойствах секции, поле «Тип секции» устанавливается значение «Итог», а в свойствах строки – «Не первая на странице». Обычно содержит клетки с вычислимыми значениями в пределах одной страницы. Отображается только при печати.
4. Повторяющаяся секция: в свойствах секции устанавливается флаг «Повторяющаяся секция» и заполняется поле «Подтаблица». Клетки секции содержат вычислимые значения или ссылки (#<Name>) на поля указанной подтаблицы. При необходимости пользовательского ввода – установить флаг «Ручное управление»
5. «Подвал» таблицы: является обычной секцией. Содержит общие итоги по таблице или другие данные, которые обязательно следуют за таблицей. Секция отображается в редакторе и на печати.

###Советы и рекомендации

При разметке шаблона, во избежание ручного масштабирования при печати, следует учитывать ширину листа после вычета полей. Чтобы элементы не выходили за границу печати, можно ограничить ширину фрейма, на котором находятся данные, или выставить максимальный размер клетки при помощи линейки или свойств столбца. Все размеры измеряются в миллиметрах.
При добавлении повторяющихся секций, если в заголовке или итогах нет необходимости, то можно оставить данные секции пустыми или скрытыми. Также можно использовать новый заголовок вместо итога.
Если клетка содержит значение справочника и открыта для редактирования, то её формат следует устанавливать ссылочным, а также заполнять реквизиты раздела «Выбор записей» и устанавливать флаг «Поле имеет кнопку выбора»

![](topic:Custom.AddFiles.СвойстваКлеток-Формат-ПолеВводаВывода.png)

При необходимости вывода дня, месяца и года в разных клетках, можно использовать формат клеток «Дата», а формат вывода как «dd», «mm» и «yyyy».
Для автоматической нумерации строк в повторяющейся секции можно использовать событие клетки «ПриВыводе» с возвратом значения Cell.Row.
Для получения суммы значений столбца повторяющейся секции для данной страница используется функция SummOfField с индексами строк в начале и конце страницы:

    sbtLines.SumOfField("LineCount", PageInfo.TopIndex, PageInfo.BottomIndex);

Цвет обводки клеток задаётся в свойствах секции, цвет фона клетки и шрифта – в свойствах клетки, цвет фона бланка – в свойствах фрейма.