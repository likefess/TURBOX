#Пользовательские расчеты

----------

**Путь к документу:** Работа с расчетами - Пользовательские расчеты

**Назначение формы:**  через работу с расчетами закладывается логика обработки данных. Внутренняя аналитика необходима для обработки поступающей информации. Форма предназначена для составления и выполнения пользовательских расчетов.


**Порядок работы с формой:** 

В системе есть два типа расчетов: пользовательский и настраиваемый расчет.  Настраиваемый расчет предполагает написание  алгоритма расчета языком ТУРБО. Пользовательский  расчет создается пользователем на основе выбранных данных. Существует два способа выборки: выбор из отчета и выбор из картотеки или БД.  По кнопке "Получить из отчета" ![](topic:Com.AddFiles.Buttons.Btn_Reportts.png)  данные берутся из отчета, т. е  с помощью редактора отчетов  можно использовать заложенную в выбранном отчете логику. Для выбранного отчета  в форме "Выбор данных из отчетов" соответственно настраиваются параметры выборки. При выборе данных для пользовательского расчета из БД или картотеки можно обработать как справочную информацию так и записи бизнес операций. Для этого необходимо воспользоваться кнопкой "Получить из картотеки" ![](topic:Com.AddFiles.Buttons.Btn_Card.png) и заполнить открывшуюся форму "Выбор данных из картотеки".

***Формирование расчета***:

![](topic:.AddFiles.Screenshot_2286.jpg)

Для формирования расчета необходимо заполнить ниже перечисленные поля  следующим способом: 

- Вид расчета - одно из значений выпадающего списка: 
     * пользовательский расчет;
     * настраиваемый расчет;
- Настройки вида - заполните форму [Настройки отображения полей](topic:.Пользовательские расчеты.Настройки отображения полей) открываемую по кнопке "Выбор" ![](topic:Com.AddFiles.Buttons.Btn_select.png).

Далее состав полей, внешний вид и порядок заполнения формы зависит от указанного значения в поле "Вид расчета".

####Пользовательский расчет:

![](topic:.AddFiles.Screenshot_2285.jpg)

#####Выбор данных для построения расчета из отчета: 

Для выбора данных из отчета необходимо нажать кнопку "Получить из отчета" ![](topic:Com.AddFiles.Buttons.Btn_Reportts.png) и настроить параметры выбора в открывшейся форме "Выбор данных из отчета":

![](topic:.AddFiles.Screenshot_2287.jpg)

* Отчет - из картотеки "Настройки отчетов" (кнопка Выбор ![](topic:Com.AddFiles.Buttons.Btn_select.png)) укажите отчет из которого будут выбраны данные. 
* Фильтр - при необходимости вручную укажите правило фильтрации отчета.
* Период - в поле "За" необходимо указать период, за который требуется провести анализ. Даты начала и конца периода проставляются соответственно с помощью календаря (кнопка Выбор ![](topic:Com.AddFiles.Buttons.Btn_select.png)), вручную, диалога “Период” или автоматически, что зависит от значения выбранного из выпадающего списка в поле За:
    * период – с помощью диалога “Период”; 
    * день – с помощью календаря; 
    * неделя – с помощью диалога “Период”; 
    * месяц – с помощью диалога “Период”; 
    * посл. месяц – автоматически; 
    * квартал – с помощью диалога “Период”; 
    * полугодие – с помощью диалога “Период”; 
    * год – с помощью диалога “Период”; 
    * все время – с помощью диалога “Период”. 

    *Замечание! Особенность работы стандартного периода: для корректной работы периода необходимо указать сначала год, а  затем месяц.*

* Применить фильтр - при установленном флаге к отчету применяется дополнительный фильтр установленный в поле "Фильтр". Иначе - используются только фильтры установленные в отчете.
* Применить период - при установленном флаге к отчету применяется период установленный в поле "За". Иначе - используется период, в разрезе которого формируется отчет.
* Тип показателя - при установленном флаге к заголовку таблицы добавляется тип показателя.

Далее заполните таблицу "Выбор данных":

* Тип в поле тип укажите разрез, контент или показатель отчета. Выбор из выпадающего списка;
* Значение установите значение для выбранного типа. Выбор из выпадающего списка, список заполняется автоматически в зависимости от установленного значения в поле "Тип";
* Вывести - значение для расчета, выводимое на экран. Устанавливается в зависимости от выбранного Типа. Заполняется из выпадающего списка.

*Строки в таблицу добавляются/удаляются с помощью опции Добавить кадр/Удалить кадр в меню вызываемом по щелчку правой кнопки мыши или с помощью клавиш Ins/Del .*

Для применения выбранных данных из отчета нажмите на кнопку **ОК** ![](topic:Com.AddFiles.Buttons.Btn_Post.png) , иначе  -  **Отмена**![](topic:Com.AddFiles.Buttons.BtnCloseCancel.png).

#####Выбор данных для построения расчета из картотеки: 

Для выбора данных из картотеки необходимо нажать кнопку "Получить из картотеки" ![](topic:Com.AddFiles.Buttons.Btn_Card.png) и настроить параметры выбора в открывшейся форме "Выбор данных из картотеки":

![](topic:.AddFiles.Screenshot_2288.jpg)

- Тип записи - из выпадающего списка укажите картотеку для выбора данных для расчета.

- На закладке "Картотека" отобразятся данные выбранной картотеки. Для записей открывшейся Картотеки можно применить Фильтр ![](topic:Com.AddFiles.Buttons.Btn_Filter.png).
- На закладке "Дополнительные поля" необходимо установить название поля с помощью диалога "Выбор поля" открывающегося по кнопке Выбор ![](topic:Com.AddFiles.Buttons.Btn_select.png).  Строки в таблицу добавляются/удаляются с помощью опции Добавить кадр/Удалить кадр в меню вызываемом по щелчку правой кнопки мыши или с помощью клавиш Ins/Del .

![](topic:.AddFiles.Screenshot_2289.jpg)

- Для переноса всех записей картотеки  в расчет нажмите кнопку "Перенести все" ![](topic:Com.AddFiles.Buttons.Btn_moveall.png). Для переноса одного или нескольких значений  картотеки, выделите записи, воспользуйтесь кнопкой Выбрать ![](topic:Com.AddFiles.Buttons.Btn_Select_Fingr.png)  или  ОК ![](topic:Com.AddFiles.Buttons.Btn_Post.png).

Далее в форме "Пользовательские расчеты" заполните входные и выходные данные для расчета. Поля заполняются из предложенных значений выпадающих списков. Списки заполняются автоматически в зависимости от выбранных ранее настроек. 

*  При установленном флаге "Выводить на экран" входные и выходные данные расчета отображаются на одноименных вкладках документа.  *Замечание : при оперировании большими объемами информации рекомендуется не выводить на экран данные расчета в целях обеспечения быстродействия системы.*

Закладка "Входные данные" отображается при установленном флаге "Выводить на экран". Показывает входные данные для расчета. Заполняется автоматически. 

Закладка "Выходные данные" отображается при установленном флаге "Выводить на экран". Показывает выходные данные расчета. Заполняется автоматически после выполнения операции "Предварительный расчет" или "Расчет". 

* Предварительный расчет запускается по кнопке ![](topic:Com.AddFiles.Buttons.Btn_Calculation.png) и выполняет расчет без записи в БД. После выполнения операции на экран выводится сообщение об успешном завершении расчета.
* Расчет - запускается по кнопке ![](topic:Com.AddFiles.Buttons.Btn_viewing.png) и выполняет расчет и запись в БД. После выполнения операции на экран выводится сообщение об успешном завершении расчета.

####Настраиваемый расчет:

![](topic:.AddFiles.Screenshot_2290.jpg)

Для построения настраиваемого расчета в поле "Скрипт" из картотеки  [Пользовательские функции](topic:.Пользовательские расчеты.Пользовательские функции) (кнопка Выбор ![](topic:Com.AddFiles.Buttons.Btn_select.png)) указывается скрипт для выполнения расчета. 

Далее пользователем  заполняются  закладки "Редактор кода", "Функции" и "Переменные".

* Редактор кода заполняется вручную на языке ТУРБО. 
* Функции  указываются из картотеки   [Пользовательские функции](topic:.Пользовательские расчеты.Пользовательские функции) (кнопка Выбор ![](topic:Com.AddFiles.Buttons.Btn_select.png)). Строки в таблицу добавляются/удаляются с помощью опции Добавить кадр/Удалить кадр в меню вызываемом по щелчку правой кнопки мыши или с помощью клавиш Ins/Del .
* Переменные указываются вручную.  Строки в таблицу добавляются/удаляются с помощью опции Добавить кадр/Удалить кадр в меню вызываемом по щелчку правой кнопки мыши или с помощью клавиш Ins/Del .

 При установленном флаге "Выводить на экран" входные и выходные данные расчета отображаются на одноименных вкладках документа.  *Замечание : при оперировании большими объемами информации рекомендуется не выводить на экран данные расчета в целях обеспечения быстродействия системы.*

* Закладка "Входные данные" отображается при установленном флаге "Выводить на экран". Показывает входные данные для расчета. Заполняется автоматически. 

* Закладка "Выходные данные" отображается при установленном флаге "Выводить на экран". Показывает выходные данные расчета. Заполняется автоматически после выполнения операции "Расчет". 

* Расчет - запускается по кнопке ![](topic:Com.AddFiles.Buttons.Btn_viewing.png) и выполняет расчет и запись в БД. После выполнения операции на экран выводится сообщение об успешном завершении расчета.

**Назначение кнопок формы:**

- Кнопка **Управление именованными настройками** ![](topic:Com.AddFiles.Buttons.Btn_Settings_menager.png):
    * **Сохранить настройки** -  открывает диалоговое окно Ввод для сохранения настроек, поле Сохранить как заполнить вручную произвольным названием настройки, подтвердить кнопкой **ОК**;
    * **Диспетчер настроек** - открывает одноименный справочник с перечнем сохраненных  настроек, применить  выбранную настройку двойным щелчком левой кнопки мыши;
    * **Без настроек** - вернуться к первоначальным настройкам;
    * Имя настройки - применить соответствующую сохраненную настройку;
- Кнопка **Отмена**![](topic:Com.AddFiles.Buttons.Btn_CloseCancel.png)- выход без сохранения;
- **Дополнительно** ![](topic:Com.AddFiles.Buttons.Btn_OK.png) - 
    - Помощь - также кнопка F1 для получения помощи.


---------    







































