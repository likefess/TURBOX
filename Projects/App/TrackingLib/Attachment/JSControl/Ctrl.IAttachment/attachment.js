!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.IAttachment=e():t.IAttachment=e()}(self,(function(){return function(){var t={484:function(t){t.exports=function(){"use strict";var t=6e4,e=36e5,n="millisecond",r="second",i="minute",s="hour",o="day",a="week",c="month",u="quarter",l="year",h="date",f="Invalid Date",d=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,p=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,m={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(t){var e=["th","st","nd","rd"],n=t%100;return"["+t+(e[(n-20)%10]||e[n]||e[0])+"]"}},v=function(t,e,n){var r=String(t);return!r||r.length>=e?t:""+Array(e+1-r.length).join(n)+t},y={s:v,z:function(t){var e=-t.utcOffset(),n=Math.abs(e),r=Math.floor(n/60),i=n%60;return(e<=0?"+":"-")+v(r,2,"0")+":"+v(i,2,"0")},m:function t(e,n){if(e.date()<n.date())return-t(n,e);var r=12*(n.year()-e.year())+(n.month()-e.month()),i=e.clone().add(r,c),s=n-i<0,o=e.clone().add(r+(s?-1:1),c);return+(-(r+(n-i)/(s?i-o:o-i))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(t){return{M:c,y:l,w:a,d:o,D:h,h:s,m:i,s:r,ms:n,Q:u}[t]||String(t||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},_="en",g={};g[_]=m;var $=function(t){return t instanceof O},w=function t(e,n,r){var i;if(!e)return _;if("string"==typeof e){var s=e.toLowerCase();g[s]&&(i=s),n&&(g[s]=n,i=s);var o=e.split("-");if(!i&&o.length>1)return t(o[0])}else{var a=e.name;g[a]=e,i=a}return!r&&i&&(_=i),i||!r&&_},M=function(t,e){if($(t))return t.clone();var n="object"==typeof e?e:{};return n.date=t,n.args=arguments,new O(n)},x=y;x.l=w,x.i=$,x.w=function(t,e){return M(t,{locale:e.$L,utc:e.$u,x:e.$x,$offset:e.$offset})};var O=function(){function m(t){this.$L=w(t.locale,null,!0),this.parse(t)}var v=m.prototype;return v.parse=function(t){this.$d=function(t){var e=t.date,n=t.utc;if(null===e)return new Date(NaN);if(x.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){var r=e.match(d);if(r){var i=r[2]-1||0,s=(r[7]||"0").substring(0,3);return n?new Date(Date.UTC(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,s)):new Date(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,s)}}return new Date(e)}(t),this.$x=t.x||{},this.init()},v.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},v.$utils=function(){return x},v.isValid=function(){return!(this.$d.toString()===f)},v.isSame=function(t,e){var n=M(t);return this.startOf(e)<=n&&n<=this.endOf(e)},v.isAfter=function(t,e){return M(t)<this.startOf(e)},v.isBefore=function(t,e){return this.endOf(e)<M(t)},v.$g=function(t,e,n){return x.u(t)?this[e]:this.set(n,t)},v.unix=function(){return Math.floor(this.valueOf()/1e3)},v.valueOf=function(){return this.$d.getTime()},v.startOf=function(t,e){var n=this,u=!!x.u(e)||e,f=x.p(t),d=function(t,e){var r=x.w(n.$u?Date.UTC(n.$y,e,t):new Date(n.$y,e,t),n);return u?r:r.endOf(o)},p=function(t,e){return x.w(n.toDate()[t].apply(n.toDate("s"),(u?[0,0,0,0]:[23,59,59,999]).slice(e)),n)},m=this.$W,v=this.$M,y=this.$D,_="set"+(this.$u?"UTC":"");switch(f){case l:return u?d(1,0):d(31,11);case c:return u?d(1,v):d(0,v+1);case a:var g=this.$locale().weekStart||0,$=(m<g?m+7:m)-g;return d(u?y-$:y+(6-$),v);case o:case h:return p(_+"Hours",0);case s:return p(_+"Minutes",1);case i:return p(_+"Seconds",2);case r:return p(_+"Milliseconds",3);default:return this.clone()}},v.endOf=function(t){return this.startOf(t,!1)},v.$set=function(t,e){var a,u=x.p(t),f="set"+(this.$u?"UTC":""),d=(a={},a[o]=f+"Date",a[h]=f+"Date",a[c]=f+"Month",a[l]=f+"FullYear",a[s]=f+"Hours",a[i]=f+"Minutes",a[r]=f+"Seconds",a[n]=f+"Milliseconds",a)[u],p=u===o?this.$D+(e-this.$W):e;if(u===c||u===l){var m=this.clone().set(h,1);m.$d[d](p),m.init(),this.$d=m.set(h,Math.min(this.$D,m.daysInMonth())).$d}else d&&this.$d[d](p);return this.init(),this},v.set=function(t,e){return this.clone().$set(t,e)},v.get=function(t){return this[x.p(t)]()},v.add=function(n,u){var h,f=this;n=Number(n);var d=x.p(u),p=function(t){var e=M(f);return x.w(e.date(e.date()+Math.round(t*n)),f)};if(d===c)return this.set(c,this.$M+n);if(d===l)return this.set(l,this.$y+n);if(d===o)return p(1);if(d===a)return p(7);var m=(h={},h[i]=t,h[s]=e,h[r]=1e3,h)[d]||1,v=this.$d.getTime()+n*m;return x.w(v,this)},v.subtract=function(t,e){return this.add(-1*t,e)},v.format=function(t){var e=this,n=this.$locale();if(!this.isValid())return n.invalidDate||f;var r=t||"YYYY-MM-DDTHH:mm:ssZ",i=x.z(this),s=this.$H,o=this.$m,a=this.$M,c=n.weekdays,u=n.months,l=function(t,n,i,s){return t&&(t[n]||t(e,r))||i[n].slice(0,s)},h=function(t){return x.s(s%12||12,t,"0")},d=n.meridiem||function(t,e,n){var r=t<12?"AM":"PM";return n?r.toLowerCase():r},m={YY:String(this.$y).slice(-2),YYYY:this.$y,M:a+1,MM:x.s(a+1,2,"0"),MMM:l(n.monthsShort,a,u,3),MMMM:l(u,a),D:this.$D,DD:x.s(this.$D,2,"0"),d:String(this.$W),dd:l(n.weekdaysMin,this.$W,c,2),ddd:l(n.weekdaysShort,this.$W,c,3),dddd:c[this.$W],H:String(s),HH:x.s(s,2,"0"),h:h(1),hh:h(2),a:d(s,o,!0),A:d(s,o,!1),m:String(o),mm:x.s(o,2,"0"),s:String(this.$s),ss:x.s(this.$s,2,"0"),SSS:x.s(this.$ms,3,"0"),Z:i};return r.replace(p,(function(t,e){return e||m[t]||i.replace(":","")}))},v.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},v.diff=function(n,h,f){var d,p=x.p(h),m=M(n),v=(m.utcOffset()-this.utcOffset())*t,y=this-m,_=x.m(this,m);return _=(d={},d[l]=_/12,d[c]=_,d[u]=_/3,d[a]=(y-v)/6048e5,d[o]=(y-v)/864e5,d[s]=y/e,d[i]=y/t,d[r]=y/1e3,d)[p]||y,f?_:x.a(_)},v.daysInMonth=function(){return this.endOf(c).$D},v.$locale=function(){return g[this.$L]},v.locale=function(t,e){if(!t)return this.$L;var n=this.clone(),r=w(t,e,!0);return r&&(n.$L=r),n},v.clone=function(){return x.w(this.$d,this)},v.toDate=function(){return new Date(this.valueOf())},v.toJSON=function(){return this.isValid()?this.toISOString():null},v.toISOString=function(){return this.$d.toISOString()},v.toString=function(){return this.$d.toUTCString()},m}(),b=O.prototype;return M.prototype=b,[["$ms",n],["$s",r],["$m",i],["$H",s],["$W",o],["$M",c],["$y",l],["$D",h]].forEach((function(t){b[t[1]]=function(e){return this.$g(e,t[0],t[1])}})),M.extend=function(t,e){return t.$i||(t(e,O,M),t.$i=!0),M},M.locale=w,M.isDayjs=$,M.unix=function(t){return M(1e3*t)},M.en=g[_],M.Ls=g,M.p={},M}()},729:function(t){"use strict";var e=Object.prototype.hasOwnProperty,n="~";function r(){}function i(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function s(t,e,r,s,o){if("function"!=typeof r)throw new TypeError("The listener must be a function");var a=new i(r,s||t,o),c=n?n+e:e;return t._events[c]?t._events[c].fn?t._events[c]=[t._events[c],a]:t._events[c].push(a):(t._events[c]=a,t._eventsCount++),t}function o(t,e){0==--t._eventsCount?t._events=new r:delete t._events[e]}function a(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),a.prototype.eventNames=function(){var t,r,i=[];if(0===this._eventsCount)return i;for(r in t=this._events)e.call(t,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(t)):i},a.prototype.listeners=function(t){var e=n?n+t:t,r=this._events[e];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,s=r.length,o=new Array(s);i<s;i++)o[i]=r[i].fn;return o},a.prototype.listenerCount=function(t){var e=n?n+t:t,r=this._events[e];return r?r.fn?1:r.length:0},a.prototype.emit=function(t,e,r,i,s,o){var a=n?n+t:t;if(!this._events[a])return!1;var c,u,l=this._events[a],h=arguments.length;if(l.fn){switch(l.once&&this.removeListener(t,l.fn,void 0,!0),h){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,e),!0;case 3:return l.fn.call(l.context,e,r),!0;case 4:return l.fn.call(l.context,e,r,i),!0;case 5:return l.fn.call(l.context,e,r,i,s),!0;case 6:return l.fn.call(l.context,e,r,i,s,o),!0}for(u=1,c=new Array(h-1);u<h;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var f,d=l.length;for(u=0;u<d;u++)switch(l[u].once&&this.removeListener(t,l[u].fn,void 0,!0),h){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,e);break;case 3:l[u].fn.call(l[u].context,e,r);break;case 4:l[u].fn.call(l[u].context,e,r,i);break;default:if(!c)for(f=1,c=new Array(h-1);f<h;f++)c[f-1]=arguments[f];l[u].fn.apply(l[u].context,c)}}return!0},a.prototype.on=function(t,e,n){return s(this,t,e,n,!1)},a.prototype.once=function(t,e,n){return s(this,t,e,n,!0)},a.prototype.removeListener=function(t,e,r,i){var s=n?n+t:t;if(!this._events[s])return this;if(!e)return o(this,s),this;var a=this._events[s];if(a.fn)a.fn!==e||i&&!a.once||r&&a.context!==r||o(this,s);else{for(var c=0,u=[],l=a.length;c<l;c++)(a[c].fn!==e||i&&!a[c].once||r&&a[c].context!==r)&&u.push(a[c]);u.length?this._events[s]=1===u.length?u[0]:u:o(this,s)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=n?n+t:t,this._events[e]&&o(this,e)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,t.exports=a}},e={};function n(r){var i=e[r];if(void 0!==i)return i.exports;var s=e[r]={exports:{}};return t[r].call(s.exports,s,s.exports,n),s.exports}n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,{a:e}),e},n.d=function(t,e){for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)};var r={};return function(){"use strict";n.d(r,{default:function(){return L}});var t=new(n(729));const e=t=>t.join("/"),i={attachment:{removeFile:e(["attachment","removeFile"]),openFile:e(["attachment","openFile"]),setFiles:e(["attachment","setFiles"])},uploadFiles:"uploadFiles",changeConfig:"changeConfig",error:{fileMaxSize:e(["error"])}},s=(t,e)=>{const n=document.createElement(t);for(const t in e)if(t in n){const r=e[t];if("function"==typeof n[t])if(Array.isArray(r[0]))for(const e of r)n[t](...e);else n[t](...r);else n[t]=r}else"_children"===t&&n.append(...e[t]);return n};var o=Object.defineProperty,a=Object.getOwnPropertySymbols,c=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable,l=(t,e,n)=>e in t?o(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,h=(t,e)=>{for(var n in e||(e={}))c.call(e,n)&&l(t,n,e[n]);if(a)for(var n of a(e))u.call(e,n)&&l(t,n,e[n]);return t},f=new class{setOptions(t){this.options=t}updateOptions(t){this.options=h(h({},this.options),t)}option(t){var e;return null!=(e=this.options[t])?e:null}};class d{constructor(t){this._init(t)}_init(e){this.container=s("div",{id:"attachments__viewer",className:"attachment__viewer viewer"}),e.appendChild(this.container),t.on(i.attachment.setFiles,this.render.bind(this)),t.on(i.changeConfig,this.rerender.bind(this))}_clearContainer(){this.container.innerHTML=""}_storeProps(t){this.props=t}remove(e){t.emit(i.attachment.removeFile,e);const n=document.getElementById(e);n&&n.parentNode.removeChild(n)}open(e){t.emit(i.attachment.openFile,e)}rerender(){this.props&&this.render(...this.props)}render(t,e=!0){this._storeProps([t,e]),e&&this._clearContainer(),t.forEach((t=>{const{ID:e}=t;this.container.appendChild(((t,e,n)=>{const{handleMouseenter:r,handleMouseleave:i}=(()=>{let t;return{handleMouseenter:e=>{const{target:n}=e;n.offsetWidth<n.scrollWidth&&(t=setTimeout((()=>{e.target.classList.add("item__name-text_full")}),300))},handleMouseleave:e=>{clearTimeout(t),e.target.classList.remove("item__name-text_full")}}})();return s("div",{className:"viewer__item item",id:t.ID,_children:[s("img",{className:"item__icon",src:t.Icon.replace(/\x0D\x0A/g,""),alt:t.Name,addEventListener:["click",n]}),s("div",{className:"item_data", _children:[s("img",{className:"item__remove",src:f.option("trashIcon"),alt:"remove",addEventListener:["click",e]}),s("div",{className:"item__name",_children:[s("div",{className:"item__name-text",innerHTML:t.Name,addEventListener:[["mouseenter",r],["mouseleave",i]]})]}),s("p",{className:"item__size",innerHTML:t.Size})]})]})})(t,this.remove.bind(this,e),this.open.bind(this,e)))}))}}const p="form__input-file";class m{constructor(t,e){this._init(t),e(this.loadFile.bind(this))}_init(e){this.container=s("div",{id:"attachments__form",className:"attachments_form form"}),e.appendChild(this.container),this.render(),t.on(i.changeConfig,this.rerender.bind(this))}_clearContainer(){this.container.innerHTML=""}loadFile(e){if(!e||0===(null==e?void 0:e.length))return;const n=[],r=e.filter((t=>t.size<=f.option("maxFileSizeUpload")?t:(n.push(t.name),!1)));n.length>0&&t.emit(i.error.fileMaxSize,n),r.length>0&&t.emit(i.uploadFiles,r)}rerender(){this._clearContainer(),this.render()}render(){var t;this.container.appendChild((t=this.loadFile.bind(this),s("div",{className:p,_children:[s("img",{alt:"cloud",src:f.option("uploadIcon")}),s("p",{innerHTML:"Перенесите файлы, чтобы прикрепить, или",_children:[s("label",{htmlFor:p,innerHTML:" кликните для выбора с компьютера"})]}),s("input",{type:"file",name:p,id:p,multiple:!0,addEventListener:["change",e=>{const n=e.target.files;t(Array.from(n))}]})]})))}}var v=n(484),y=n.n(v),_=(t,e,n)=>new Promise(((r,i)=>{var s=t=>{try{a(n.next(t))}catch(t){i(t)}},o=t=>{try{a(n.throw(t))}catch(t){i(t)}},a=t=>t.done?r(t.value):Promise.resolve(t.value).then(s,o);a((n=n.apply(t,e)).next())})),g=new class{_getBase64(t){return _(this,null,(function*(){return new Promise((e=>{const n=new FileReader;n.onload=t=>{e(t.target.result)},n.readAsDataURL(t)}))}))}getBase64(t){return _(this,null,(function*(){return Array.isArray(t)||(t=[t]),yield Promise.all(t.map((t=>_(this,null,(function*(){return yield this._getBase64(t)})))))}))}getFileDate(t,e){const{lastModified:n}=t;return y()(n).format(e)}};new class{constructor(){this._init()}_init(){t.on(i.attachment.removeFile,(t=>{this.sendMessage("DelAttachment",t)})),t.on(i.attachment.openFile,(t=>{this.sendMessage("OpenAttachment",t)})),t.on(i.uploadFiles,(t=>{return e=this,null,n=function*(){const e=yield g.getBase64(t);t=t.map(((t,n)=>({base64:e[n],size:t.size,name:t.name,date:g.getFileDate(t,"DD.MM.YYYY HH:mm:ss")}))),this.sendMessage("UploadFiles",JSON.stringify({FilesInfo:t}))},new Promise(((t,r)=>{var i=t=>{try{o(n.next(t))}catch(t){r(t)}},s=t=>{try{o(n.throw(t))}catch(t){r(t)}},o=e=>e.done?t(e.value):Promise.resolve(e.value).then(i,s);o((n=n.apply(e,null)).next())}));var e,n})),t.on(i.error.fileMaxSize,(t=>{this.sendMessage("ErrorFileMaxSize",JSON.stringify({FilesNames:t}))}))}sendMessage(t,e){Array.isArray(e)||(e=[e]),window.callProcEx(t,e)}};var $=(t,e,n)=>new Promise(((r,i)=>{var s=t=>{try{a(n.next(t))}catch(t){i(t)}},o=t=>{try{a(n.throw(t))}catch(t){i(t)}},a=t=>t.done?r(t.value):Promise.resolve(t.value).then(s,o);a((n=n.apply(t,e)).next())}));function w(t){return $(this,null,(function*(){return new Promise(((e,n)=>{t.file((t=>e(t)))}))}))}function M(t){return $(this,null,(function*(){let e=[],n=yield x(t);for(;n.length>0;)e.push(...n),n=yield x(t);return e}))}function x(t){return $(this,null,(function*(){try{return yield new Promise(((e,n)=>{t.readEntries(e,n)}))}catch(t){console.log(t)}}))}const O="draggable",b=(t,e)=>{const n=e=>{e.preventDefault(),t.classList.add(O)},r=e=>{e.preventDefault(),t.classList.remove(O)};[["dragover",n],["dragstart",n],["dragleave",r],["dragend",r],["drop",t=>$(void 0,null,(function*(){t.preventDefault(),f.option("isNative")?e(Array.from(t.dataTransfer.files)):e(yield function(t){return $(this,null,(function*(){let e=[],n=[];for(let e=0;e<t.length;e++)n.push(t[e].webkitGetAsEntry());for(;n.length>0;){let t=n.shift();t.isFile?e.push(yield w(t)):t.isDirectory&&n.push(...yield M(t.createReader()))}return e}))}(t.dataTransfer.items)),r(t)}))]].forEach((([e,n])=>{t.addEventListener(e,n)}))},D=new ResizeObserver((t=>{for(const e of t){let t=window.frameElement;const n=e.contentRect.height;t&&(t.height=n),window.callProcEx("ResizeBrowser",[n])}}));class S{constructor(t){this.rootContainer=document.getElementById("attachment"),this.init(t),D.observe(this.rootContainer)}init(t){this._setOptions(t),this.form=new m(this.rootContainer,this.setLoadFile.bind(this)),this.viewer=new d(this.rootContainer),this._render()}_render(){b(this.rootContainer,this._loadFile)}setLoadFile(t){this._loadFile=t}onEvent(e,n){t.on(e,n)}setFiles(e){t.emit(i.attachment.setFiles,JSON.parse(e).FilesInfo)}_setOptions(t){f.setOptions(t)}updateOptions(e){f.updateOptions(JSON.parse(e)),t.emit(i.changeConfig,f.options)}}const F={maxFileSizeUpload:15e5,uploadIcon:"",trashIcon:"",isNative:!1};function L(){return new S(F)}}(),r.default}()}));