

---
Keywords: Пример настройки интеграции 2.0, Загрузка данных в структуру ТУРБО
---




#Загрузка данных из файла в структуру ТУРБО

####Пример файла для загрузки:

Требуется загрузить данные в картотеку Субъекты из файла в формате CSV.

```
Группа;Это группа;Код;Название;Это юридическое лицо;ИНН
;True;ГФЛ.00001;Физлица;False;
ГФЛ.00001;False;ФЛ.00001;Иванов Иван Иванович;False;770001000021
ГФЛ.00001;False;ФЛ.00002;Петрова Ирина Юрьевна;False;770002000070
ГФЛ.00001;False;ФЛ.00003;Сидорова Юлия Ивановна;False;770003000010
ГФЛ.00001;False;ФЛ.00004;Машкова Ольга Петровна;False;770004000069
ГФЛ.00001;False;ФЛ.00013;Кушнир Ирина Николаевна;False;770013000040
ГФЛ.00001;False;ФЛ.00019;Марченко Богдан Назарович;False;770019000015
ГФЛ.00001;False;ФЛ.00023;Осокин Олег Васильевич;False;770023000071
```
Субъекты в базе Турбо хранятся Администрирование/Настройки/Управление доступом/Субъекты.

**Порядок действий для загрузки:**

1. Необходимо создать элемент справочника [Настройка][Настройка] (Путь: Интеграция - Данные и справочники - Основные справочники - Настройка) и заполнить параметры настройки.
2. Создать [Источник][Источник] - файл CSV
3. Создать [Приемник][Приемник] - TB запись
4. Создать [Соответствие полей][Соответствие полей] между источником и приемником
5. [Запуск настройки обмена][Запуск настройки обмена] - может быть выполнен вручную или запущен по [Расписанию](topic:.Интеграция.Версия 2_0.Данные и справочники.Расписание)
6. [Логирование][Логирование], любая настройка обмена может быть записана в лог.

####Настройка

**Создать [Настройку](topic:.Интеграция.Версия 2_0.Данные и справочники.Настройка) Процессор соответствия полей:**


![](topic:.AddFiles.Screenshot_11957.jpg)

* Наименование произвольное;
* Тип обработки = [Процессор соответствия полей](topic:.Интеграция.Версия 2_0.Сервис.Программный класс обработки.Процессор соответствия полей.Default);
* Источник - с помощью кнопки Выбор![](topic:Integration.AddFiles.Buttons.Btn_select.png) откройте картотеку [Точки подключения](topic:.Интеграция.Версия 2_0.Данные и справочники.Точка подключения), если нужной точки подключения нет, то создайте новую точкой подключения "Субъекты CSV" с помощью кнопки Добавить ![](topic:Com.AddFiles.Btn_Add.png). Заполните [Источник][Источник];
* Приемник - с помощью кнопки Выбор![](topic:Integration.AddFiles.Buttons.Btn_select.png) откройте картотеку [Точки подключения](topic:.Интеграция.Версия 2_0.Данные и справочники.Точка подключения), если нужной точки подключения нет, то создайте новую точкой подключения "Субъекты ТВ" с помощью кнопки Добавить ![](topic:Com.AddFiles.Btn_Add.png). Заполните [Приемник][Приемник];
* [Соответствие полей][Соответствие полей] - с помощью кнопки Выбор![](topic:Integration.AddFiles.Buttons.Btn_select.png) откройте картотеку [Соответствие полей](topic:.Интеграция.Версия 2_0.Сервис.Программный класс обработки.Процессор соответствия полей.Соответствие полей), создайте правило сопоставления "настройка соответствия полей Субъекты" с помощью кнопки Добавить ![](topic:Com.AddFiles.Btn_Add.png).


####Источник

**Создание источника данных**:


[Точка подключения](topic:.Интеграция.Версия 2_0.Данные и справочники.Точка подключения)

  Создаем точку подключения  с наименованием "Субъекты CSV".

![](topic:.AddFiles.Screenshot_12074.jpg)



* [Тип точки подключения](topic:.Интеграция.Версия 2_0.Данные и справочники.Типы точек подключения.Default)

Задаем Тип точки подключения - [Таблица CSV](topic:.Интеграция.Версия 2_0.Данные и справочники.Типы точек подключения.Таблица CSV)  (идет в базовой поставке):


* В параметре  FileName указать путь к файлу CSV, в котором хранятся субъекты.
* [Структура объекта](topic:.Интеграция.Версия 2_0.Данные и справочники.Структура объекта) - для создания новой структуры объекта воспользуйтесь кнопкой **Сервисы** ![](topic:Integration.AddFiles.Buttons.Btn_Services.png) - ![](topic:.AddFiles.Buttons.Btn_Add_new.png)  Создать структуру объекта:
    * Наименование "структура объекта Субъекты";
  <!--   * В Список таблиц объекта добавить таблицу 2 уровня;
   <!--  * Воспользоваться кнопкой **Разнести поля** для переноса отмеченных флагами полей в созданную таблицу;  !-->
    * Структуру объекта сохранить кнопкой **ОК** ![](topic:Com.AddFiles.Buttons.Btn_Post.png).

![](topic:.AddFiles.Screenshot_11959.jpg)


Правило заполнения дескриптора для [типа точки подключения Таблица CSV (Версия2)](topic:.Интеграция.Версия 2_0.Данные и справочники.Типы точек подключения.Таблица CSV)


####Приемник

**Создание приемника данных:**

[Точка подключения](topic:.Интеграция.Версия 2_0.Данные и справочники.Точка подключения)

  Создаем точку подключения  с наименованием "Субъекты ТВ".

![](topic:.AddFiles.Screenshot_12075.jpg)



* [Тип точки подключения](topic:.Интеграция.Версия 2_0.Данные и справочники.Типы точек подключения.Default)

Задаем Тип точки подключения - [ТВ запись](topic:.Интеграция.Версия 2_0.Данные и справочники.Типы точек подключения.ТВ запись)  (идет в базовой поставке):
* Параметры:
    * *Project* - выбранный проект в Турбо, подключенный к информационной базе "Bas";
    * *Record* - выбранный класс записи в Турбо, входящий в проект Project "Rec.Data.Entity";
    * *CardForm* - картотека выбранного класса записи Record, подставилась автоматически "Bas.Tab.Data.Entity";
    * *Filter* - Фильтр, по которому отбираются конкретные записи. В картотеке Субъекты по щелчку правой кнопки мыши выбираем Свойства на закладке Картотека поле Фильтр.


* [Структура объекта](topic:.Интеграция.Версия 2_0.Данные и справочники.Структура объекта) - для создания новой структуры объекта воспользуйтесь кнопкой **Сервисы** ![](topic:Integration.AddFiles.Buttons.Btn_Services.png) - ![](topic:.AddFiles.Buttons.Btn_Add_new.png)  Создать структуру объекта:
    * Наименование "Структура Субъекты ТВ";
    * Структуру объекта сохранить кнопкой **ОК** ![](topic:Com.AddFiles.Buttons.Btn_Post.png).

![](topic:.AddFiles.Screenshot_11961.jpg)


Правило заполнения дескриптора для [типа точки подключения ТВ запись (Версия2)](topic:.Интеграция.Версия 2_0.Данные и справочники.Типы точек подключения.ТВ запись)


####Соответствие полей

**Соответствие полей между источником и приемником:**

Создаем новое [Соответствие полей](topic:.Интеграция.Версия 2_0.Сервис.Программный класс обработки.Процессор соответствия полей.Соответствие полей) с наименованием "настройка соответствия полей Субъекты".

![](topic:.AddFiles.Screenshot_11962.jpg)

* Объект источник - заполняется с помощью списка Структур объектов созданный источник данных (кнопка Выбор ![](topic:Integration.AddFiles.Buttons.Btn_select.png)) - "структура объекта Субъекты";
* Объект приемник - заполняется с помощью списка Структур объектов созданный приемник данных (кнопка Выбор ![](topic:Integration.AddFiles.Buttons.Btn_select.png)) - "Структура Субъекты ТВ".
* Заполняем блок Таблицы:
    * Заполнить Таблицу источник, Таблицу приемник;
    * Обновление данных = Создать новый, настроить соответствие полей таблиц (кнопка ![](topic:Com.AddFiles.Buttons.Btn_Zamena.png)):

    ![](topic:.AddFiles.Screenshot_11963.jpg)

    В поле Группа исходного файла находится группа субъекта, поэтому для загрузки в поле Группа в приемнике нужно выбрать "Правило преобразования"  [Поиск по значению](topic:.Интеграция.Версия 2_0.Сервис.Правила преобразования.Поиск по значению) с поиском записи по полю Code.
    Подробнее о доступных правилах преобразования см. [Правила преобразования](Topic:Integration.Интеграция.Версия 2_0.Сервис.Правила преобразования.Default.md)

    <!--* Для поля Company "Правило преобразования"  используется  [Поиск по значению](topic:.Интеграция.Версия 2_0.Данные и справочники.Правила преобразования.Поиск по значению), в поле приемника стоит Предприятие - объектный тип.!-->

   При Настройке параметров преобразования для Группа с помощью кнопки ![](topic:.AddFiles.Buttons.Btn_Edit.png) открываем форму и  Имя поля поиска задаем Code:
  <!--* , потому что в файле компания задана наименованием  !-->

  ![](topic:.AddFiles.Screenshot_11964.jpg)

    <!--* ![](topic:.AddFiles.Screenshot_11624.jpg)

    * Для таблиц второго уровня обновление данных - Создать новый, настроить соответствие полей таблиц (кнопка ![](topic:Com.AddFiles.Buttons.Btn_Zamena.png)):

    ![](topic:.AddFiles.Screenshot_11625.jpg)

    Для ТМЦ [Поиск по значению](topic:.Интеграция.Версия 2_0.Данные и справочники.Правила преобразования.Поиск по значению) будет осуществляться по Name, для Валюта - по Code.!-->

    * Соответствие полей сохранить кнопкой **ОК** ![](topic:Com.AddFiles.Buttons.Btn_Post.png).


####Запуск настройки обмена

Настройку обмена можно запустить как вручную в любой момент,так и по расписанию в соответствии с настройкой расписания. Одна настройка может быть связана с несколькими расписаниями.

Запуск настройки обмена осуществляется с помощью кнопки **Сервисы** ![](topic:Integration.AddFiles.Buttons.Btn_Services.png):

- Выполнить - загрузка/выгрузка выполняется на клиенте;
- Выполнить асинхронно - загрузка/выгрузка выполняется на сервере, при этом клиент продолжает работу. После выполнения клиенту сообщается о загрузке в диалоговом окне;
- Добавить расписание - открывает для создания форму [Расписание](topic:.Интеграция.Версия 2_0.Данные и справочники.Расписание) на основе введенных в настройке данных;
- Просмотр расписания - открывает картотеку [Расписание](topic:.Интеграция.Версия 2_0.Данные и справочники.Расписание) с фильтром по данной настройке.


####Логирование

Для просмотра лога выполнения воспользуйтесь картотекой [Логирование событий](topic:.Интеграция.Версия 2_0.Сервис.Логирование) при условии включенного логирования.

![](topic:.AddFiles.Screenshot_11965.jpg)

























