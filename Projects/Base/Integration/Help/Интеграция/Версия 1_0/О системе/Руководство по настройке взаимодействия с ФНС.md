<link rel=stylesheet href="topic:style.css" type="text/css">
<META Name="keywords" Content="ФНС, api-fns">

# Руководство по настройке взаимодействия с ФНС

**ТУРБО ERP** поддерживает сервис получения данных о контрагентах от ФНС.

## Предварительные условия

Перед началом использования сервиса убедитесь в следующем:

* В вашем контуре установлена и настроена платформа TURBO X и конфигурация не ниже версии 10.2
* Проект **ESB** установлен, в глобальных переменных указан url для подключения к нему (см. [Руководство пользователя](Topic:Integration.Интеграция.Версия 1_0.О системе.Руководство пользователя), пункт **Настройка расположения ESB**)
* В справочнике **Тип точки подключения** присутствует тип *FNS flow (automatic download)*
* В справочнике **Соответствие полей** присутствует запись с кодом *fns_mapping*

## Создание точки подключения

Требуется создать точку подключения с использованием типа потока *FNS flow (automatic download)*. Подробно о точке см. [Точка подключения](Topic:Integration.Интеграция.Версия 1_0.Справочники.Точка подключения)

* Выбрать тип точки *FNS flow (automatic download)*
* В параметре **http-outbound-url** указать ключ, выданный api-fns.ru при регистрации. Например:

    `https://api-fns.ru/api/egr?req={inn}&key=123456789qwe`

    <img src="Topic:Integration.AddFiles.ScreenShots.fns_endpoint.png" class="screenshot"/>

### Соответствие полей

Для сопоставления полей объекта **Контрагенты** и получаемых от ФНС данных предустановлена настройка соответствия *fns_mapping*. Убедитесь в её наличии и соответствии приведенному ниже скриншоту.

**Категорически не рекомендуется менять настройки сопоставления полей!**

<img src="Topic:Integration.AddFiles.ScreenShots.fns_mapping.png" class="screenshot"/>

## Получение данных о контрагенте

Если все вышеперечисленные шаги выполнены успешно, то в картотеке **Контрагенты**, на форме контрагента будет доступна функция **Заполнить данные по ИНН**

<img src="Topic:Integration.AddFiles.ScreenShots.заполнить_по_инн.png" class="screenshot"/>

В блоке **Налоговые реквизиты** введите ИНН контрагента и нажмите **Сервис - Заполнить данные по ИНН**.

Если указанный контрагент являются действующим, то на форме будут автоматически заполнены его данные: налоговые и регистрационные реквизиты, дополнительная информация.

Вкладка *Основное*:

<img src="Topic:Integration.AddFiles.ScreenShots.фнс_действующий_основное.png" class="screenshot"/>

Вкладка *Дополнительно*:

<img src="Topic:Integration.AddFiles.ScreenShots.фнс_действующий_дополнительно.png" class="screenshot"/>

Если указанный контрагент прекратил свою деятельность, будет отображено предупреждение:

<img src="Topic:Integration.AddFiles.ScreenShots.фнс_недействующий.png" class="screenshot"/>